/*!
 * @license
 * TradingView Lightweight Charts v1.2.1
 * Copyright (c) 2019 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(){"use strict";var t,i;function n(t,i,n,h,r,u){isFinite(i)&&isFinite(h)&&isFinite(n)&&isFinite(r)&&(t.save(),s(t,u),t.beginPath(),t.moveTo(i,n),t.lineTo(h,r),t.stroke(),t.restore())}function s(t,i){var n,s=((n={})[0]=[],n[1]=[t.lineWidth,2*t.lineWidth],n[2]=[5*t.lineWidth,6*t.lineWidth],n[3]=[6*t.lineWidth,6*t.lineWidth],n[4]=[t.lineWidth,4*t.lineWidth],n)[i];t.setLineDash(s)}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps"}(t||(t={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(i||(i={}));var h=function(t,i){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(t,i)};function r(t,i){function n(){this.constructor=t}h(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}var u=function(){return(u=Object.assign||function(t){for(var i,n=1,s=arguments.length;n<s;n++)for(var h in i=arguments[n])Object.prototype.hasOwnProperty.call(i,h)&&(t[h]=i[h]);return t}).apply(this,arguments)};function e(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function o(t){if(void 0===t)throw new Error("Value is undefined");return t}function f(t){if(null===t)throw new Error("Value is null");return t}function a(t){return f(o(t))}function c(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var s=0,h=i;s<h.length;s++){var r=h[s];for(var u in r)void 0!==r[u]&&("object"!=typeof r[u]||void 0===t[u]?t[u]=r[u]:c(t[u],r[u]))}return t}function l(t){return"number"==typeof t&&isFinite(t)}function v(t){return"number"==typeof t&&t%1==0}function d(t){return"string"==typeof t}function w(t){return!(t<=0||t>0)}function b(t){var i,n,s,h=t;if(!h||"object"!=typeof h)return h;for(n in i=Array.isArray(h)?[]:{},h)h.hasOwnProperty(n)&&(s=h[n],i[n]=s&&"object"==typeof s?b(s):s);return i}function m(t){return null!==t}function M(t){return null===t?void 0:t}var p=function(){function t(){this.t=[]}return t.prototype.setRenderers=function(t){this.t=t},t.prototype.draw=function(t,i){this.t.forEach((function(n){t.save(),n.draw(t,i),t.restore()}))},t}(),g=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){if(null!==this._data&&null!==this._data.visibleRange){var i=this._data.visibleRange,n=this._data,s=function(s){t.beginPath();for(var h=i.to-1;h>=i.from;--h){var r=n.items[h];t.moveTo(r.x,r.y),t.arc(r.x,r.y,s,0,2*Math.PI)}t.fill()};t.fillStyle=n.backColor,s(n.radius+2),t.fillStyle=n.lineColor,s(n.radius)}},t}();var y,k,N,S,x={from:0,to:1},C=function(){function t(t,i){this.i=new p,this.s=[],this.u=[],this.o=!0,this.l=t,this.v=i,this.i.setRenderers(this.s)}return t.prototype.update=function(t){var i=this,n=this.l.serieses();n.length!==this.s.length&&(this.u=n.map((function(){return{items:[{x:0,y:0,time:0,price:0}],lineColor:"",backColor:i.l.options().layout.backgroundColor,radius:0,visibleRange:null}})),this.s=this.u.map((function(t){var i=new g;return i.setData(t),i})),this.i.setRenderers(this.s)),this.o=!0},t.prototype.renderer=function(t,i,n){return this.o&&(this.m(),this.o=!1),this.i},t.prototype.m=function(){var t=this,i=this.l.serieses(),n=this.v.appliedIndex(),s=this.l.timeScale();i.forEach((function(i,h){var r=t.u[h],u=i.markerDataAtIndex(n);if(null!==u){var e=f(i.firstValue());r.lineColor=i.barColorer().barStyle(n).barColor,r.backColor=t.l.options().layout.backgroundColor,r.radius=u.radius,r.items[0].price=u.price,r.items[0].y=i.priceScale().priceToCoordinate(u.price,e.value),r.items[0].time=n,r.items[0].x=s.indexToCoordinate(n),r.visibleRange=x}else r.visibleRange=null}))},t}(),D=function(){function t(t){this.M=t}return t.prototype.draw=function(t){if(null!==this.M){var i=this.M.vertLine.visible,s=this.M.horzLine.visible;if(i||s){var h=this.M.vertLine.lineWidth%2==0?.5:0,r=this.M.horzLine.lineWidth%2==0?.5:0,u=this.M.x+1+r,e=this.M.y+h,o=this.M.w,f=this.M.h;i&&u>=0&&(t.lineWidth=this.M.vertLine.lineWidth,t.strokeStyle=this.M.vertLine.color,t.fillStyle=this.M.vertLine.color,n(t,u,0,u,f,this.M.vertLine.lineStyle)),s&&e>=0&&(t.lineWidth=this.M.horzLine.lineWidth,t.strokeStyle=this.M.horzLine.color,t.fillStyle=this.M.horzLine.color,n(t,0,e,o,e,this.M.horzLine.lineStyle))}}},t}(),E=function(){function t(t){this.o=!0,this.p={vertLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},horzLine:{lineWidth:1,lineStyle:0,color:"",visible:!1},w:0,h:0,x:0,y:0},this.g=new D(this.p),this.k=t}return t.prototype.update=function(){this.o=!0},t.prototype.renderer=function(t,i){return this.o&&this.m(),this.g},t.prototype.m=function(){var t=this.k.visible(),i=f(this.k.pane()),n=i.model().options().crosshair,s=this.p;s.horzLine.visible=t&&this.k.horzLineVisible(i),s.vertLine.visible=t&&this.k.vertLineVisible(),s.horzLine.lineWidth=n.horzLine.width,s.horzLine.lineStyle=n.horzLine.style,s.horzLine.color=n.horzLine.color,s.vertLine.lineWidth=n.vertLine.width,s.vertLine.lineStyle=n.vertLine.style,s.vertLine.color=n.vertLine.color,s.w=i.width(),s.h=i.height(),s.x=this.k.appliedX(),s.y=this.k.appliedY()},t}(),T={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",feldspar:"#d19275",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslateblue:"#8470ff",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",violetred:"#d02090",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function A(t){return function(t,i,n){return w(i)?t:i<t?t:i>n?n:Math.round(i)}(0,t,255)}function L(t){return function(t,i,n){return w(i)?t:i<t?t:i>n?n:Math.round(1e4*i)/1e4}(0,t,1)}function B(t){(t=t.toLowerCase())in T&&(t=T[t]);var i,n,s=(i=t,null!==(n=N.re.exec(i))?N.parse(n):null);if(null!==s)return s;var h=function(t){var i=k.re.exec(t);return null!==i?k.parse(i):null}(t);if(null!==h)return h;var r=function(t){var i=y.re.exec(t);return null!==i?y.parse(i):null}(t);if(null!==r)return r;var u=function(t){var i=S.re.exec(t);return null!==i?S.parse(i):null}(t);return null!==u?[u[0],u[1],u[2]]:null}function z(t){var i=B(t);if(null!==i)return i;throw new Error("Passed color string "+t+" does not match any of the known color representations")}function F(t,i){if(i<0||i>255)throw new Error("invalid threshold value, valid values are [0, 255]");return function(t){return.199*t[0]+.687*t[1]+.114*t[2]}(t)>=i?"white":"black"}function V(t){return function(t){return 0===t.indexOf("#")}(t)?t:(n=z(t),s=1,"rgba("+(i=[n[0],n[1],n[2],L(s)])[0]+", "+i[1]+", "+i[2]+", "+i[3]+")");var i,n,s}function O(t){return"black"===F(z(t),160)?"white":"black"}!function(t){t.re=/^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/,t.parse=function(t){return[A(parseInt(t[1]+t[1],16)),A(parseInt(t[2]+t[2],16)),A(parseInt(t[3]+t[3],16))]}}(y||(y={})),function(t){t.re=/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,t.parse=function(t){return[A(parseInt(t[1],16)),A(parseInt(t[2],16)),A(parseInt(t[3],16))]}}(k||(k={})),function(t){t.re=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,t.parse=function(t){return[A(parseInt(t[1],10)),A(parseInt(t[2],10)),A(parseInt(t[3],10))]}}(N||(N={})),function(t){t.re=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/,t.parse=function(t){return[A(parseInt(t[1],10)),A(parseInt(t[2],10)),A(parseInt(t[3],10)),L(parseFloat(t[4]))]}}(S||(S={}));var I=function(){function t(t,i){this.setData(t,i)}return t.prototype.setData=function(t,i){this.M=t,this.N=i},t.prototype.draw=function(t,i,n,s,h){if(this.M.visible){var r=i.fontSize;t.font=i.font;var u=this.M.tickVisible?i.tickLength:0,e=this.M.borderVisible?i.borderSize:0,o=i.paddingTop,f=i.paddingBottom,a=i.paddingInner,c=i.paddingOuter,l=this.M.text,v=Math.ceil(n.measureText(t,l)),d=i.baselineOffset,w=i.fontSize+o+f,b=e+v+a+c+u,m=this.N.coordinate;this.N.fixedCoordinate&&(m=this.N.fixedCoordinate);var M,p,g=m-Math.floor(r/2)-o-.5,y=g+w,k="right"===h,N=k?s-e-.5:.5,S=N;t.fillStyle=V(this.N.background),t.lineWidth=1,t.lineCap="butt",l&&(k?(M=N-u,p=(S=N-b)+c):(S=N+b,M=N+u,p=N+e+u+a),t.beginPath(),t.moveTo(N,g),t.lineTo(S,g),t.lineTo(S,y),t.lineTo(N,y),t.fill(),this.M.tickVisible&&(t.beginPath(),t.strokeStyle=this.N.color,t.moveTo(N,m),t.lineTo(M,m),t.stroke()),t.textAlign="left",t.fillStyle=this.N.color,t.fillText(l,p,y-f-d))}},t.prototype.height=function(t,i){return this.M.visible?t.fontSize+t.paddingTop+t.paddingBottom:0},t}(),P=function(){function t(t){this.S={coordinate:0,color:"#FFF",background:"#000"},this.C={text:"",visible:!1,tickVisible:!0,borderVisible:!0,lineStyle:1},this.D={text:"",visible:!1,tickVisible:!1,borderVisible:!1,lineStyle:1},this.o=!0,this.T=new(t||I)(this.C,this.S),this.A=new(t||I)(this.D,this.S)}return t.prototype.text=function(){return this.C.text},t.prototype.background=function(){return this.S.background},t.prototype.color=function(){return O(this.background())},t.prototype.coordinate=function(){return this.L(),this.S.coordinate},t.prototype.floatCoordinate=function(){return this.L(),this.S.floatCoordinate||this.S.coordinate},t.prototype.update=function(){this.o=!0},t.prototype.height=function(t,i){return void 0===i&&(i=!1),Math.max(this.T.height(t,i),this.A.height(t,i))},t.prototype.getFixedCoordinate=function(){return this.S.fixedCoordinate||0},t.prototype.setFixedCoordinate=function(t){this.S.fixedCoordinate=t},t.prototype.isVisible=function(){return this.L(),this.C.visible||this.D.visible},t.prototype.isAxisLabelVisible=function(){return this.L(),this.C.visible},t.prototype.isPaneLabelVisible=function(){return this.L(),this.D.visible},t.prototype.renderer=function(){return this.L(),this.T.setData(this.C,this.S),this.A.setData(this.D,this.S),this.T},t.prototype.paneRenderer=function(){return this.L(),this.T.setData(this.C,this.S),this.A.setData(this.D,this.S),this.A},t.prototype.L=function(){this.o&&(this._updateRendererData(this.C,this.D,this.S),this.o=!1)},t}(),R=function(t){function i(i,n,s){var h=t.call(this)||this;return h.k=i,h.B=n,h.F=s,h}return r(i,t),i.prototype._updateRendererData=function(t,i,n){t.visible=!1;var s=this.k.options().horzLine;if(s.labelVisible){var h=this.B.firstValue();if(this.k.visible()&&!this.B.isEmpty()&&null!==h){n.background=s.labelBackgroundColor,n.color=O(s.labelBackgroundColor);var r=this.F(this.B);n.coordinate=r.coordinate,t.text=this.B.formatPrice(r.price,h),t.visible=!0}}},i}(P),W=/[1-9]/g,q=function(){function t(){this.M=null}return t.prototype.setData=function(t){this.M=t},t.prototype.draw=function(t,i){if(null!==this.M&&!1!==this.M.visible&&0!==this.M.text.length){t.font=i.font;var n=Math.round(i.widthCache.measureText(t,this.M.text,W));if(!(n<=0)){var s=i.paddingHorizontal,h=n+2*s,r=h/2,u=this.M.width,e=this.M.coordinate,o=Math.floor(e-r)+.5;o<0?(e+=Math.abs(0-o),o=Math.floor(e-r)+.5):o+h>u&&(e-=Math.abs(u-(o+h)),o=Math.floor(e-r)+.5);var f=o+h,a=-.5+i.borderSize+i.paddingTop+i.fontSize+i.paddingBottom;t.fillStyle=this.M.background,t.lineWidth=1,function(t,i,n,s,h,r){t.beginPath(),t.moveTo(i+r,n),t.lineTo(i+s-r,n),t.arcTo(i+s,n,i+s,n+r,r),t.lineTo(i+s,n+h-r),t.arcTo(i+s,n+h,i+s-r,n+h,r),t.lineTo(i+r,n+h),t.arcTo(i,n+h,i,n+h-r,r),t.lineTo(i,n+r),t.arcTo(i,n,i+r,n,r)}(t,o,-.5,f-o,a- -.5,1),t.fill();var c=Math.round(this.M.coordinate+1),l=-.5+i.borderSize+i.tickLength;t.strokeStyle=this.M.color,t.beginPath(),t.moveTo(c,-.5),t.lineTo(c,l),t.stroke();var v=a-i.baselineOffset-i.paddingBottom;t.textAlign="left",t.fillStyle=this.M.color,t.fillText(this.M.text,o+s,v)}}},t}();var U,j=function(t){function i(i,n,s){var h=t.call(this)||this;return h.o=!0,h.g=new q,h.p={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN},h.v=i,h.V=n,h.F=s,h}return r(i,t),i.prototype.update=function(){this.o=!0},i.prototype.renderer=function(){return this.o&&(this.m(),this.o=!1),this.g.setData(this.p),this.g},i.prototype.m=function(){var t=this.p;t.visible=!1;var i=this.v.options().vertLine;if(i.labelVisible){var n=this.V.timeScale();if(!n.isEmpty()){var s=n.indexToUserTime(this.v.appliedIndex());t.width=n.width();var h=this.F();h.time&&(t.coordinate=h.coordinate,t.text=n.formatDateTime(f(s)),t.visible=!0,t.background=i.labelBackgroundColor,t.color=O(i.labelBackgroundColor))}}},i}(function(){function t(){this._text="",this._background="#585858",this._coordinate=0}return t.prototype.text=function(){return this._text},t.prototype.background=function(){return this._background},t.prototype.color=function(){return"black"===F(z(this._background),150)?"white":"black"},t.prototype.coordinate=function(){return this._coordinate},t}()),H=function(){function t(){this._priceScale=null,this.O=0}return t.prototype.zorder=function(){return this.O},t.prototype.setZorder=function(t){this.O=t},t.prototype.priceScale=function(){return this._priceScale},t.prototype.setPriceScale=function(t){this._priceScale=t},t.prototype.priceAxisViews=function(t,i){return[]},t.prototype.paneViews=function(t){return[]},t.prototype.timeAxisViews=function(){return[]},t}();!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(U||(U={}));var Y=function(t){function i(i,n){var s=t.call(this)||this;s.I=null,s.P=NaN,s.R=0,s.W=!0,s.q=new Map,s.U=!1,s.j=NaN,s.H=NaN,s.Y=NaN,s._=NaN,s.V=i,s.K=n,s.$=new C(i,s);var h,r;s.X=(h=function(){return s.P},r=function(){return s.H},function(t){var i=r(),n=h();if(t===f(s.I).defaultPriceScale())return{price:n,coordinate:i};var u=f(t.firstValue());return{price:t.coordinateToPrice(i,u),coordinate:i}});var u=function(t,i){return function(){return{time:s.V.timeScale().indexToUserTime(t()),coordinate:i()}}}((function(){return s.R}),(function(){return s.appliedX()}));return s.Z=new j(s,i,u),s.J=new E(s),s}return r(i,t),i.prototype.index=function(){return this.R},i.prototype.options=function(){return this.K},i.prototype.saveOriginCoord=function(t,i){this.Y=t,this._=i},i.prototype.clearOriginCoord=function(){this.Y=NaN,this._=NaN},i.prototype.originCoordX=function(){return this.Y},i.prototype.originCoordY=function(){return this._},i.prototype.setPosition=function(t,i,n){this.U||(this.U=!0),this.W=!0,this.G(t,i,n)},i.prototype.appliedIndex=function(){return this.R},i.prototype.appliedX=function(){return this.j},i.prototype.appliedY=function(){return this.H},i.prototype.visible=function(){return this.W},i.prototype.clearPosition=function(){this.W=!1,this.tt(),this.P=NaN,this.j=NaN,this.H=NaN,this.I=null,this.clearOriginCoord()},i.prototype.paneViews=function(t){return null!==this.I?[this.J,this.$]:[]},i.prototype.horzLineVisible=function(t){return t===this.I&&this.K.horzLine.visible},i.prototype.vertLineVisible=function(){return this.K.vertLine.visible},i.prototype.priceAxisViews=function(t,i){this.W&&this.I===t||this.q.clear();var n=[];return this.I===t&&n.push(this.it(this.q,i,this.X)),n},i.prototype.timeAxisViews=function(){return this.W?[this.Z]:[]},i.prototype.pane=function(){return this.I},i.prototype.updateAllViews=function(){this.q.forEach((function(t){return t.update()})),this.Z.update(),this.$.update()},i.prototype.nt=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},i.prototype.G=function(t,i,n){this.st(t,i,n)&&this.updateAllViews()},i.prototype.st=function(t,i,n){var s=this.j,h=this.H,r=this.P,u=this.R,e=this.I,o=this.nt(n);this.R=t,this.j=isNaN(t)?NaN:this.V.timeScale().indexToCoordinate(t);var f=null!==o?o.firstValue():null;return null!==o&&null!==f?(this.I=n,this.P=i,this.H=o.priceToCoordinate(i,f)):(this.I=null,this.P=NaN,this.H=NaN),s!==this.j||h!==this.H||u!==this.R||r!==this.P||e!==this.I},i.prototype.tt=function(){var t=this.V.serieses().map((function(t){return t.bars().lastIndex()})).filter(m),i=0===t.length?null:Math.max.apply(Math,t);this.R=null!==i?i:NaN},i.prototype.it=function(t,i,n){var s=t.get(i);return void 0===s&&(s=new R(this,i,n),t.set(i,s)),s},i}(H),_=".",K="'";function $(t,i){if(!l(t))return"n/a";if(!v(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}var X,Z=function(){function t(t,i,n,s){if(i||(i=1),l(t)&&v(t)||(t=100),t<0)throw new TypeError("invalid base");this.B=t,this.ht=i,this.rt=s,n&&void 0!==s&&s>0&&2!==s&&4!==s&&8!==s||(this.ut=n,this.et())}return t.prototype.format=function(t){var i=t<0?"âˆ’":"";return t=Math.abs(t),this.ut?i+this.ot(t):i+this.ft(t)},t.prototype.et=function(){if(this._fractionalLength=0,this.B>0&&this.ht>0){var t=this.B;for(this.ut&&this.rt&&(t/=this.rt);t>1;)t/=10,this._fractionalLength++}},t.prototype.ft=function(t){var i;i=this.ut?Math.pow(10,this._fractionalLength||0):this.B/this.ht;var n=Math.floor(t),s="",h=void 0!==this._fractionalLength?this._fractionalLength:NaN;if(i>1){var r=+(Math.round(t*i)-n*i).toFixed(this._fractionalLength);r>=i&&(r-=i,n+=1),s=_+$(+r.toFixed(this._fractionalLength)*this.ht,h)}else n=Math.round(n*i)/i,h>0&&(s=_+$(0,h));return n.toFixed(0)+s},t.prototype.ot=function(t){var i=this.B/this.ht,n=Math.floor(t),s=Math.round(t*i)-n*i;if(s===i&&(s=0,n+=1),!this._fractionalLength)throw new Error("_fractionalLength is not calculated");var h="";if(this.rt){var r=s%this.rt,u=$(s=(s-r)/this.rt,this._fractionalLength),e=2===this.rt?["0","5"][r]:8===this.rt?["0","1","2","3","4","5","6","7"][r]:["0","2","5","7"][r];h=u+K+e}else h=$(s*this.ht,this._fractionalLength);return n.toString()+K+h},t}(),J=function(t){function i(i){return void 0===i&&(i=100),t.call(this,i)||this}return r(i,t),i.prototype.format=function(i){return t.prototype.format.call(this,i)+"%"},i}(Z),G=function(){function t(){this.at=[]}return t.prototype.subscribe=function(t,i,n){var s={callback:t,linkedObject:i,singleshot:!0===n};this.at.push(s)},t.prototype.unsubscribe=function(t){var i=this.at.findIndex((function(i){return t===i.callback}));i>-1&&this.at.splice(i,1)},t.prototype.unsubscribeAll=function(t){this.at=this.at.filter((function(i){return i.linkedObject===t}))},t.prototype.fire=function(t,i){var n=function(){for(var t=0,i=0,n=arguments.length;i<n;i++)t+=arguments[i].length;var s=Array(t),h=0;for(i=0;i<n;i++)for(var r=arguments[i],u=0,e=r.length;u<e;u++,h++)s[h]=r[u];return s}(this.at);this.at=this.at.filter((function(t){return!t.singleshot})),n.forEach((function(n){return n.callback(t,i)}))},t.prototype.hasListeners=function(){return this.at.length>0},t.prototype.destroy=function(){this.at=[]},t}(),Q=function(t){function i(i){var n=t.call(this)||this;return n.V=i,n}return r(i,t),i.prototype.model=function(){return this.V},i.prototype.minMove=function(){return 0},i.prototype.autoscaleInfo=function(t,i){return null},i}(H),tt=function(){function t(t,i){this.ct=t,this.lt=i}return t.prototype.equals=function(t){return null!==t&&(this.ct===t.ct&&this.lt===t.lt)},t.prototype.clone=function(){return new t(this.ct,this.lt)},t.prototype.minValue=function(){return this.ct},t.prototype.setMinValue=function(t){this.ct=t},t.prototype.maxValue=function(){return this.lt},t.prototype.setMaxValue=function(t){this.lt=t},t.prototype.length=function(){return this.lt-this.ct},t.prototype.isEmpty=function(){return this.lt===this.ct||Number.isNaN(this.lt)||Number.isNaN(this.ct)},t.prototype.merge=function(i){return null===i?this:new t(Math.min(this.minValue(),i.minValue()),Math.max(this.maxValue(),i.maxValue()))},t.prototype.apply=function(t,i){this.ct=Math.min(this.ct,t),this.lt=Math.max(this.lt,i)},t.prototype.set=function(t,i){this.ct=t,this.lt=i},t.prototype.scaleAroundCenter=function(t){if(l(t)&&0!==this.lt-this.ct){var i=.5*(this.lt+this.ct),n=this.lt-i,s=this.ct-i;n*=t,s*=t,this.lt=i+n,this.ct=i+s}},t.prototype.shift=function(t){l(t)&&(this.lt+=t,this.ct+=t)},t.prototype.containsStrictly=function(t){return t.minValue()>this.ct&&t.maxValue()<this.lt},t}();function it(t,i,n){return Math.min(Math.max(t,i),n)}function nt(t,i,n){return i-t<=n}function st(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function ht(t,i){var n=100*(t-i)/i;return i<0?-n:n}function rt(t,i){var n=ht(t.minValue(),i),s=ht(t.maxValue(),i);return new tt(n,s)}function ut(t,i){var n=100*(t-i)/i+100;return i<0?-n:n}function et(t,i){var n=ut(t.minValue(),i),s=ut(t.maxValue(),i);return new tt(n,s)}function ot(t){var i=Math.abs(t);if(i<1e-8)return 0;var n=st(i+1e-4)+4;return t<0?-n:n}function ft(t){var i=Math.abs(t);if(i<1e-8)return 0;var n=Math.pow(10,i-4)-1e-4;return t<0?-n:n}function at(t){if(null===t)return null;var i=ot(t.minValue()),n=ot(t.maxValue());return new tt(i,n)}!function(t){t[t.LogicalOffset=4]="LogicalOffset",t[t.CoordOffset=1e-4]="CoordOffset"}(X||(X={}));var ct=function(){function t(t,i){if(this.vt=t,this.dt=i,function(t){if(t<0)return!1;for(var i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.vt))this.wt=[2,2.5,2];else{this.wt=[];for(var n=this.vt;1!==n;){if(n%2==0)this.wt.push(2),n/=2;else{if(n%5!=0)throw new Error("unexpected base");this.wt.push(2),this.wt.push(2.5),n/=5}if(this.wt.length>100)throw new Error("something wrong with base")}}}return t.prototype.tickSpan=function(t,i,n){for(var s,h,r,u=0===this.vt?0:1/this.vt,e=Math.pow(10,Math.max(0,Math.ceil(st(t-i)))),o=0,f=this.dt[0];;){var a=nt(e,u,1e-9)&&e>u+1e-9,c=nt(e,n*f,1e-9),l=nt(e,1,1e-9);if(!(a&&c&&l))break;e/=f,f=this.dt[++o%this.dt.length]}if(e<=u+1e-9&&(e=u),e=Math.max(1,e),this.wt.length>0&&(s=e,h=1,r=1e-9,Math.abs(s-h)<r))for(o=0,f=this.wt[0];nt(e,n*f,1e-9)&&e>u+1e-9;)e/=f,f=this.wt[++o%this.wt.length];return e},t}(),lt=function(){function t(t,i,n,s){this.bt=[],this.B=t,this.vt=i,this.Mt=n,this.pt=s}return t.prototype.setBase=function(t){if(t<0)throw new Error("base < 0");this.vt=t},t.prototype.tickSpan=function(t,i){if(t<i)throw new Error("high < low");var n=this.B.height(),s=(t-i)*this.gt()/n,h=new ct(this.vt,[2,2.5,2]),r=new ct(this.vt,[2,2,2.5]),u=new ct(this.vt,[2.5,2,2]),e=[];return e.push(h.tickSpan(t,i,s)),e.push(r.tickSpan(t,i,s)),e.push(u.tickSpan(t,i,s)),function(t){if(t.length<1)throw Error("array is empty");for(var i=t[0],n=1;n<t.length;++n)t[n]<i&&(i=t[n]);return i}(e)},t.prototype.rebuildTickMarks=function(){var t=this.B,i=t.firstValue();if(null!==i){var n=t.height(),s=this.Mt(n-1,i),h=this.Mt(0,i),r=this.B.options().entireTextOnly?this.yt()/2:0,u=r,e=n-1-r,o=Math.max(s,h),f=Math.min(s,h);if(o!==f){for(var a=this.tickSpan(o,f),c=o%a,l=o>=f?1:-1,v=null,d=0,w=o-(c+=c<0?a:0);w>f;w-=a){var b=this.pt(w,i,!0);null!==v&&Math.abs(b-v)<this.gt()||(b<u||b>e||(d<this.bt.length?(this.bt[d].coord=Math.round(b),this.bt[d].label=t.formatLogical(w)):this.bt.push({coord:Math.round(b),label:t.formatLogical(w)}),d++,v=b,t.isLog()&&(a=this.tickSpan(w*l,f))))}this.bt.length=d}else this.bt=[]}else this.bt=[]},t.prototype.marks=function(){return this.bt},t.prototype.yt=function(){return this.B.fontSize()},t.prototype.gt=function(){return Math.ceil(2.5*this.yt())},t}(),vt=function(){function t(t){this.kt=t}return t.prototype.format=function(t){var i="";return t<0&&(i="-",t=-t),t<995?i+this.Nt(t):t<999995?i+this.Nt(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.Nt(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.Nt(t/1e9)+"B")},t.prototype.Nt=function(t){var i=Math.pow(10,this.kt);return((t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this.kt).replace(/\.?0+$/,""):String(t)).replace(/(\.[1-9]*)0+$/,(function(t,i){return i}))},t}();function dt(t,i,n,s){if(0!==i.length){var h=i[s.from].x,r=i[s.from].y;t.moveTo(h,r);for(var u=s.from+1;u<s.to;++u){var e=i[u];if(1===n){var o=i[u-1].y,f=e.x;t.lineTo(f,o)}t.lineTo(e.x,e.y)}}}var wt=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){if(null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange){t.save(),t.lineCap="square",t.strokeStyle=this._data.lineColor,t.lineWidth=this._data.lineWidth,s(t,this._data.lineStyle),t.lineWidth=1,t.beginPath(),t.moveTo(this._data.items[this._data.visibleRange.from].x,this._data.bottom),t.lineTo(this._data.items[this._data.visibleRange.from].x,this._data.items[this._data.visibleRange.from].y),dt(t,this._data.items,this._data.lineType,this._data.visibleRange),t.lineTo(this._data.items[this._data.visibleRange.to-1].x,this._data.bottom),t.lineTo(this._data.items[this._data.visibleRange.from].x,this._data.bottom),t.closePath();var i=t.createLinearGradient(0,0,0,this._data.bottom);i.addColorStop(0,this._data.topColor),i.addColorStop(1,this._data.bottomColor),t.fillStyle=i,t.fill(),t.restore()}},t}(),bt=function(){function t(){this._data=null}return t.prototype.setData=function(t){this._data=t},t.prototype.draw=function(t){null!==this._data&&0!==this._data.items.length&&null!==this._data.visibleRange&&(t.lineCap="square",t.lineWidth=this._data.lineWidth,s(t,this._data.lineStyle),t.strokeStyle=this._data.lineColor,t.lineJoin="miter",t.beginPath(),dt(t,this._data.items,this._data.lineType,this._data.visibleRange),t.stroke())},t}();function mt(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var u=r>>1,e=s+u;n(t[e],i)?(s=e+1,r-=u+1):r=u}return s}function Mt(t,i,n,s,h){void 0===s&&(s=0),void 0===h&&(h=t.length);for(var r=h-s;0<r;){var u=r>>1,e=s+u;n(i,t[e])?r=u:(s=e+1,r-=u+1)}return s}function pt(t,i){return t.time<i}function gt(t,i){return t<i.time}function yt(t,i,n){var s=i.firstBar(),h=i.lastBar(),r=mt(t,s,pt),u=Mt(t,h,gt);if(!n)return{from:r,to:u};var e=r,o=u;return r>0&&r<t.length&&t[r].time>=s&&(e=r-1),u>0&&u<t.length&&t[u-1].time<=h&&(o=u+1),{from:e,to:o}}var kt=function(){function t(t,i,n){this._invalidated=!0,this._dataInvalidated=!0,this._items=[],this._itemsVisibleRange=null,this._series=t,this._model=i,this.St=n}return t.prototype.update=function(t){this._invalidated=!0,"data"===t&&(this._dataInvalidated=!0)},t.prototype._makeValid=function(){this._dataInvalidated&&(this._fillRawPoints(),this._dataInvalidated=!1),this._invalidated&&(this._updatePoints(),this._invalidated=!1)},t.prototype._clearVisibleRange=function(){this._itemsVisibleRange=null},t.prototype._updatePoints=function(){var t=this._series.priceScale(),i=this._model.timeScale();if(this._clearVisibleRange(),!i.isEmpty()&&!t.isEmpty()){var n=i.visibleBars();if(null!==n&&0!==this._series.data().bars().size()){var s=this._series.firstValue();null!==s&&(this._itemsVisibleRange=yt(this._items,n,this.St),this._convertToCoordinates(t,i,s.value))}}},t}(),Nt=function(t){function i(i,n){return t.call(this,i,n,!0)||this}return r(i,t),i.prototype._convertToCoordinates=function(t,i,n){i.indexesToCoordinates(this._items,M(this._itemsVisibleRange)),t.pointsArrayToCoordinates(this._items,n,M(this._itemsVisibleRange))},i.prototype._createRawItemBase=function(t,i){return{time:t,price:i,x:NaN,y:NaN}},i.prototype._fillRawPoints=function(){var t=this,i=this._series.barFunction(),n=[],s=this._series.barColorer();this._series.bars().each((function(h,r){var u=i(r.value),e=t._createRawItem(h,u,s);return n.push(e),!1})),this._items=n},i}(kt),St=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.g=new p,s.xt=new wt,s.Ct=new bt,s.g.setRenderers([s.xt,s.Ct]),s}return r(i,t),i.prototype.renderer=function(t,i){this._makeValid();var n=this._series.options(),s={lineType:n.lineType,items:this._items,lineColor:n.lineColor,lineStyle:n.lineStyle,lineWidth:n.lineWidth,topColor:n.topColor,bottomColor:n.bottomColor,bottom:t,visibleRange:this._itemsVisibleRange};return this.xt.setData(s),this.Ct.setData(s),this.g},i.prototype._createRawItem=function(t,i){return this._createRawItemBase(t,i)},i}(Nt);function xt(t){return.3*t}var Ct,Dt=function(){function t(){this.M=null,this.Dt=0,this.Et=0}return t.prototype.setData=function(t){this.M=t,this.Dt=xt(t.barSpacing),this.Et=t.thinBars?1:Math.max(1,Math.round(this.Dt))},t.prototype.draw=function(t){if(null!==this.M&&0!==this.M.bars.length&&null!==this.M.visibleRange){t.save(),t.translate(.5,.5);for(var i=this.M.thinBars?1:Math.round(this.Dt),n=this.M.thinBars?1:i/2,s=null,h=this.M.visibleRange.from;h<this.M.visibleRange.to;++h){var r=this.M.bars[h];s!==r.color&&(t.fillStyle=r.color,s=r.color),t.fillRect(Math.round(r.x-this.Et/2),Math.round(r.highY-n),Math.round(this.Et),Math.round(r.lowY-r.highY+i)),this.Et<this.M.barSpacing-1&&(this.M.openVisible&&t.fillRect(Math.round(r.x-1.5*this.Dt),Math.floor(r.openY-n),Math.round(1.5*this.Dt),i),t.fillRect(Math.round(r.x),Math.floor(r.closeY-n),Math.round(1.5*this.Dt),i))}t.restore()}},t}(),Et=function(t){function i(i,n){return t.call(this,i,n,!1)||this}return r(i,t),i.prototype._convertToCoordinates=function(t,i,n){i.indexesToCoordinates(this._items,M(this._itemsVisibleRange)),t.barPricesToCoordinates(this._items,n,M(this._itemsVisibleRange))},i.prototype._createDefaultItem=function(t,i,n){return{time:t,open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},i.prototype._fillRawPoints=function(){var t=this,i=[],n=this._series.barColorer();this._series.bars().each((function(s,h){var r=t._createRawItem(s,h,n);return i.push(r),!1})),this._items=i},i}(kt),Tt=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.g=new Dt,s}return r(i,t),i.prototype.renderer=function(t,i){this._makeValid();var n=this._series.options(),s={bars:this._items,barSpacing:this._model.timeScale().barSpacing(),openVisible:n.openVisible,thinBars:n.thinBars,visibleRange:this._itemsVisibleRange};return this.g.setData(s),this.g},i.prototype._createRawItem=function(t,i,n){return u(u({},this._createDefaultItem(t,i,n)),{color:n.barStyle(t).barColor})},i}(Et);!function(t){t[t.BarBorderWidth=1]="BarBorderWidth"}(Ct||(Ct={}));var At=function(){function t(){this.M=null,this.Dt=0}return t.prototype.setData=function(t){this.M=t,this.Dt=xt(t.barSpacing)},t.prototype.draw=function(t){if(null!==this.M&&0!==this.M.bars.length&&null!==this.M.visibleRange)if(t.lineCap="square",this.M.barSpacing<1)this.Tt(t);else{var i=this.M.bars;t.translate(-.5,-.5),t.lineWidth=1,this.M.wickVisible&&this.At(t,i,this.M.visibleRange),this.M.borderVisible&&this.Lt(t,i,this.M.visibleRange),this.Bt(t,i,this.M.visibleRange)}},t.prototype.At=function(t,i,n){for(var s="",h=n.from;h<n.to;h++){var r=i[h];r.wickColor!==s&&(t.fillStyle=r.wickColor,s=r.wickColor),t.fillRect(r.x,r.highY,1,r.lowY-r.highY)}},t.prototype.Lt=function(t,i,n){for(var s="",h=n.from;h<n.to;h++){var r=i[h];r.borderColor!==s&&(t.fillStyle=r.borderColor,s=r.borderColor);var u=Math.round(r.x-this.Dt),e=Math.round(r.x+this.Dt),o=Math.min(r.openY,r.closeY),f=Math.max(r.openY,r.closeY);t.fillRect(u,o,e-u+1,f-o+1)}},t.prototype.Bt=function(t,i,n){if(null!==this.M)for(var s="",h=n.from;h<n.to;h++){var r=i[h],u=Math.min(r.openY,r.closeY),e=Math.max(r.openY,r.closeY),o=Math.round(r.x-this.Dt),f=Math.round(r.x+this.Dt);if(this.M.borderVisible&&(o+=1,u+=1,f-=1,e-=1),!(u>e)){if(r.color!==s){var a=r.color;t.fillStyle=a,s=a}t.fillRect(o,u,f-o+1,e-u+1)}}},t.prototype.Tt=function(t){if(null!==this.M&&null!==this.M.visibleRange){if(t.lineWidth=1,this.M.wickVisible){t.strokeStyle=this.M.wickColor,t.beginPath();for(var i=this.M.visibleRange.from;i<this.M.visibleRange.to;i++){var n=this.M.bars[i];t.moveTo(n.x,n.lowY),t.lineTo(n.x,n.highY)}t.stroke()}var s="",h=!1;t.beginPath();for(i=this.M.visibleRange.from;i<this.M.visibleRange.to;i++){s!==(n=this.M.bars[i]).color&&(h&&(t.stroke(),t.beginPath(),h=!1),t.strokeStyle=n.color,s=n.color),t.moveTo(n.x,n.openY),t.lineTo(n.x,n.closeY),h=!0}h&&t.stroke()}},t}(),Lt=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.g=new At,s}return r(i,t),i.prototype.renderer=function(t,i){this._makeValid();var n=this._series.options(),s={bars:this._items,barSpacing:this._model.timeScale().barSpacing(),wickColor:n.wickColor,wickVisible:n.wickVisible,borderVisible:n.borderVisible,visibleRange:this._itemsVisibleRange};return this.g.setData(s),this.g},i.prototype._createRawItem=function(t,i,n){var s=n.barStyle(t);return u(u({},this._createDefaultItem(t,i,n)),{color:s.barColor,wickColor:s.barWickColor,borderColor:s.barBorderColor})},i}(Et),Bt=function(){function t(){this.M=null}return t.prototype.setData=function(t){this.M=t},t.prototype.draw=function(t){if(null!==this.M&&0!==this.M.items.length&&null!==this.M.visibleRange){var i=this.M.histogramBase;t.translate(.5,.5),t.fillStyle=this.M.color,t.lineWidth=1,t.beginPath();for(var n=this.M.visibleRange.from;n<this.M.visibleRange.to;n++){var s=this.M.items[n],h=s.y,r=s.left,u=s.right;t.rect(r,h,u-r,i-h)}t.fill()}},t}();var zt,Ft=function(t){function i(i,n){var s=t.call(this,i,n,!1)||this;return s.i=new p,s.zt=[],s.Ft=[],s.Vt=new Int32Array(0),s.Ot=new Int32Array(0),s}return r(i,t),i.prototype.renderer=function(t,i){return this._makeValid(),this.i},i.prototype._fillRawPoints=function(){var t=this,i=this._model.timeScale().barSpacing(),n=this._series.palette();this.Ft.length=n.size(),this.zt.length=n.size();var s=new Int32Array(n.size()+1),h=this._series.options(),r=this._series.barFunction();this.Vt=new Int32Array(this._series.bars().size());var u=0;this._items.length=this._series.bars().size();var e=0,o=this._series.options().color;this._series.bars().each((function(f,a){var c=r(a.value),l=a.value[4],v={time:f,price:c,x:NaN,y:NaN},d=null!=l?n.colorByIndex(l):o,w=null==l?0:l+1,b=t.zt[w]||function(t,i,n){return{items:[],barSpacing:t,lineWidth:i,histogramBase:NaN,color:n,visibleRange:null}}(i,h.lineWidth,d),m=s[w]++;return m<b.items.length?b.items[m]=v:b.items.push(v),t._items[e++]={time:f,x:0},t.zt[w]=b,t.Vt[u++]=w,!1})),this.Ft.length=this.zt.length,this.Ot.length!==this.zt.length&&(this.Ot=new Int32Array(this.zt.length)),this.zt.forEach((function(i,n){i.items.length=s[n];var h=t.Ft[n]||new Bt;h.setData(i),t.Ft[n]=h})),this.i.setRenderers(this.Ft)},i.prototype._clearVisibleRange=function(){t.prototype._clearVisibleRange.call(this),this.zt.forEach((function(t,i){t.visibleRange=null}))},i.prototype._convertToCoordinates=function(t,i,n){var s=this;if(null!==this._itemsVisibleRange){var h=i.barSpacing(),r=f(i.visibleBars()),u=t.priceToCoordinate(this._series.options().base,n);this.zt.forEach((function(h,e){i.indexesToCoordinates(h.items),t.pointsArrayToCoordinates(h.items,n),h.histogramBase=u,h.visibleRange=yt(h.items,r,!1),s.Ot[e]=h.visibleRange.from}));for(var e=null,o=this._itemsVisibleRange.from;o<this._itemsVisibleRange.to;++o){var a=this.Vt[o],c=this.zt[a],l=this.Ot[a]++,v=c.items[l];if(v.left=Math.floor(v.x-.5*h),v.right=Math.ceil(v.left+h),null!==e&&v.time-e.time==1){var d=v.right-v.left>5?1:0;e.right=v.left-d}e=v}}},i}(kt),Vt=function(t){function i(i,n){var s=t.call(this,i,n)||this;return s.Ct=new bt,s}return r(i,t),i.prototype.renderer=function(t,i){this._makeValid();var n=this._series.options(),s={items:this._items,lineColor:n.color,lineStyle:n.lineStyle,lineType:n.lineType,lineWidth:n.lineWidth,visibleRange:this._itemsVisibleRange};return this.Ct.setData(s),this.Ct},i.prototype._createRawItem=function(t,i){return this._createRawItemBase(t,i)},i}(Nt),Ot=/[2-9]/g,It=function(){function t(t){void 0===t&&(t=50),this.It=0,this.Pt=1,this.Rt=1,this.Wt={},this.qt={},this.Ut=t}return t.prototype.reset=function(){this.It=0,this.qt={},this.Pt=1,this.Rt=1,this.Wt={}},t.prototype.measureText=function(t,i,n){var s=n||Ot,h=String(i).replace(s,"0");if(this.qt[h])return this.qt[h].width;if(this.It===this.Ut){var r=this.Wt[this.Rt];delete this.Wt[this.Rt],delete this.qt[r],this.Rt++,this.It--}var u=t.measureText(h).width;return 0===u&&i.length?0:(this.qt[h]={width:u,tick:this.Pt},this.Wt[this.Pt]=h,this.It++,this.Pt++,u)},t}(),Pt=function(){function t(t){this.jt=null,this.Ht=null,this.Yt="right",this._t=0,this.Kt=t}return t.prototype.setParams=function(t,i,n,s){this.jt=t,this.Ht=i,this._t=n,this.Yt=s},t.prototype.draw=function(t){null!==this.Ht&&null!==this.jt&&this.jt.draw(t,this.Ht,this.Kt,this._t,this.Yt)},t}(),Rt=function(){function t(t,i,n){this.$t=t,this.Kt=new It(50),this.Xt=i,this.l=n,this.Zt=-1,this.g=new Pt(this.Kt)}return t.prototype.update=function(){this.$t.update()},t.prototype.renderer=function(t,i){var n=this.l.paneForSource(this.Xt);if(null===n)return null;if(null===this.Xt.priceScale())return null;var s=n.priceScalePosition();if("overlay"===s)return null;var h=this.l.priceAxisRendererOptions();return h.fontSize!==this.Zt&&(this.Zt=h.fontSize,this.Kt.reset()),this.g.setParams(this.$t.paneRenderer(),h,i,s),this.g},t}(),Wt=function(){function t(){this.M=null}return t.prototype.setData=function(t){this.M=t},t.prototype.draw=function(t){if(null!==this.M&&!1!==this.M.visible){var i=this.M.y;if(!(i<0||i>this.M.height)){var s=this.M.width;t.lineCap="square",t.strokeStyle=this.M.color,t.lineWidth=this.M.lineWidth,n(t,0,i,s,i,this.M.lineStyle)}}},t}(),qt=function(){function t(t){this._lineRendererData={width:0,height:0,y:0,color:"rgba(0, 0, 0, 0)",lineWidth:1,lineStyle:0,visible:!1},this._lineRenderer=new Wt,this.o=!0,this._series=t,this._model=t.model(),this._lineRenderer.setData(this._lineRendererData)}return t.prototype.update=function(){this.o=!0},t.prototype.renderer=function(){return this.o&&(this._updateImpl(),this.o=!1),this._lineRenderer},t}(),Ut=function(t){function i(i){return t.call(this,i)||this}return r(i,t),i.prototype._updateImpl=function(){this._lineRendererData.visible=!1;var t=this._series.priceScale(),i=t.mode().mode;if(2===i||3===i){var n=this._series.options();if(n.baseLineVisible){var s=this._series.firstValue();null!==s&&(this._lineRendererData.visible=!0,this._lineRendererData.y=t.priceToCoordinate(s.value,s.value),this._lineRendererData.width=this._model.timeScale().width(),this._lineRendererData.height=t.height(),this._lineRendererData.color=n.baseLineColor,this._lineRendererData.lineWidth=n.baseLineWidth,this._lineRendererData.lineStyle=n.baseLineStyle)}}},i}(qt);function jt(t,i){return Yt(Math.min(Math.max(t,12),30)*i)}function Ht(t,i){switch(t){case"arrowDown":case"arrowUp":return jt(i,1);case"circle":return jt(i,.8);case"square":return jt(i,.7)}}function Yt(t){var i=Math.ceil(t);return i%2==0?i-1:i}function _t(t){return i=jt(t,1),(n=Math.ceil(i))%2!=0?n-1:n;var i,n}function Kt(t){return Math.max(jt(t,.1),3)}function $t(t,i,n,s,h){var r=Ht("square",n),u=(r-1)/2,e=t-u,o=i-u;return s>=e&&s<=e+r&&h>=o&&h<=o+r}function Xt(t,i,n,s,h,r){var u=(Ht("arrowUp",r)-1)/2,e=(Yt(r/2)-1)/2;i.fillStyle=h,i.beginPath(),t?(i.moveTo(n-u,s),i.lineTo(n,s-u),i.lineTo(n+u,s),i.lineTo(n+e,s),i.lineTo(n+e,s+u),i.lineTo(n-e,s+u),i.lineTo(n-e,s)):(i.moveTo(n-u,s),i.lineTo(n,s+u),i.lineTo(n+u,s),i.lineTo(n+e,s),i.lineTo(n+e,s-u),i.lineTo(n-e,s-u),i.lineTo(n-e,s)),i.fill()}function Zt(t,i,n,s,h,r){return $t(i,n,s,h,r)}!function(t){t[t.MinShapeSize=12]="MinShapeSize",t[t.MaxShapeSize=30]="MaxShapeSize",t[t.MinShapeMargin=3]="MinShapeMargin"}(zt||(zt={}));var Jt=function(){function t(){this.M=null}return t.prototype.setData=function(t){this.M=t},t.prototype.draw=function(t,i,n){if(null!==this.M&&null!==this.M.visibleRange){t.save(),t.translate(.5,.5);for(var s=this.M.visibleRange.from;s<this.M.visibleRange.to;s++){Gt(this.M.items[s],t)}t.restore()}},t.prototype.hitTest=function(t,i){if(null===this.M||null===this.M.visibleRange)return null;for(var n=this.M.visibleRange.from;n<this.M.visibleRange.to;n++){var s=this.M.items[n];if(Qt(s,t,i))return{hitTestData:s.internalId,externalId:s.externalId}}return null},t}();function Gt(t,i){switch(t.shape){case"arrowDown":return void Xt(!1,i,t.x,t.y,t.color,t.size);case"arrowUp":return void Xt(!0,i,t.x,t.y,t.color,t.size);case"circle":return void function(t,i,n,s,h){var r=(Ht("circle",h)-1)/2;t.fillStyle=s,t.beginPath(),t.arc(i,n,r,0,2*Math.PI,!1),t.fill()}(i,t.x,t.y,t.color,t.size);case"square":return void function(t,i,n,s,h){var r=Ht("square",h),u=(r-1)/2,e=i-u,o=n-u;t.fillStyle=s,t.fillRect(e,o,r,r)}(i,t.x,t.y,t.color,t.size)}t.shape}function Qt(t,i,n){switch(t.shape){case"arrowDown":case"arrowUp":return Zt(0,t.x,t.y,t.size,i,n);case"circle":return function(t,i,n,s,h){var r=2+Ht("circle",n)/2,u=t-s,e=i-h;return Math.sqrt(u*u+e*e)<=r}(t.x,t.y,t.size,i,n);case"square":return $t(t.x,t.y,t.size,i,n)}t.shape}function ti(t,i,n,s,h,r,u,e){var o=l(n)?n:n.close,f=l(n)?n:n.high,a=l(n)?n:n.low,c=_t(u.barSpacing());switch(t.size=c,i.position){case"inBar":return void(t.y=r.priceToCoordinate(o,e));case"aboveBar":return t.y=r.priceToCoordinate(f,e)-c/2-s.aboveBar,void(s.aboveBar+=c+h);case"belowBar":return t.y=r.priceToCoordinate(a,e)+c/2+s.belowBar,void(s.belowBar+=c+h)}i.position}var ii,ni=function(){function t(t,i){this.o=!0,this.Jt=!0,this.Gt=!0,this.Qt=null,this.g=new Jt,this.ti=t,this.V=i,this.M={items:[],visibleRange:null}}return t.prototype.update=function(t){this.o=!0,this.Gt=!0,"data"===t&&(this.Jt=!0)},t.prototype.renderer=function(t,i,n){return this.o&&this._makeValid(),this.g.setData(this.M),this.g},t.prototype.autoScaleMargins=function(){if(this.Gt){if(this.ti.indexedMarkers().length>0){var t=this.V.timeScale().barSpacing(),i=Kt(t),n=1.5*_t(t)+2*i;this.Qt={above:n,below:n}}else this.Qt=null;this.Gt=!1}return this.Qt},t.prototype._makeValid=function(){var t=this.ti.priceScale(),i=this.V.timeScale(),n=this.ti.indexedMarkers();this.Jt&&(this.M.items=n.map((function(t){return{time:t.time,x:0,y:0,size:0,shape:t.shape,color:t.color,internalId:t.internalId,externalId:t.id}})),this.Jt=!1),this.M.visibleRange=null;var s=i.visibleBars();if(null!==s){var h=this.ti.firstValue();if(null!==h){var r=NaN,u=Kt(i.barSpacing()),e={aboveBar:u,belowBar:u};this.M.visibleRange=yt(this.M.items,s,!0);for(var o=this.M.visibleRange.from;o<this.M.visibleRange.to;o++){var f=n[o];f.time!==r&&(e.aboveBar=u,e.belowBar=u,r=f.time);var a=this.M.items[o];a.x=i.indexToCoordinate(f.time);var c=this.ti.dataAt(f.time);null!==c&&ti(a,f,c,e,u,t,i,h.value)}this.o=!1}}},t}(),si=function(t){function i(i){return t.call(this,i)||this}return r(i,t),i.prototype._updateImpl=function(){this._lineRendererData.visible=!1;var t=this._series.options();if(t.priceLineVisible){var i=this._series.lastValueData(void 0,!0);i.noData||(this._lineRendererData.visible=!0,this._lineRendererData.y=i.coordinate,this._lineRendererData.color=this._series.priceLineColor(i.color),this._lineRendererData.width=this._model.timeScale().width(),this._lineRendererData.height=this._series.priceScale().height(),this._lineRendererData.lineWidth=t.priceLineWidth,this._lineRendererData.lineStyle=t.priceLineStyle)}},i}(qt),hi=function(t){function i(i,n){var s=t.call(this)||this;return s.k=i,s.M=n,s}return r(i,t),i.prototype._getSource=function(){return this.k},i.prototype._getData=function(){return this.M},i.prototype._updateRendererData=function(t,i,n){t.visible=!1,i.visible=!1;var s=this.k.options(),h=s.lastValueVisible,r=""!==this.k.title(),u=0===s.seriesLastValueMode,e=this.k.lastValueData(void 0,!1);e.noData||(h&&(t.text=this._axisText(e,h,u),t.visible=0!==t.text.length),(r||u)&&(i.text=this._paneText(e,h,r,u),i.visible=i.text.length>0),n.background=this.k.priceLineColor(e.color),n.color=O(n.background),n.coordinate=e.coordinate,n.floatCoordinate=e.floatCoordinate)},i.prototype._paneText=function(t,i,n,s){var h="",r=this.k.title();return n&&0!==r.length&&(h+=r+" "),i&&s&&(h+=this.k.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),h.trim()},i.prototype._axisText=function(t,i,n){return i?n?this.k.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},i}(P),ri=function(t){function i(i,n){var s=t.call(this,i)||this;return s.ii=n,s}return r(i,t),i.prototype._updateImpl=function(){var t=this._lineRendererData;t.visible=!1;var i=this._series.priceScale(),n=this._model.timeScale();if(!n.isEmpty()&&!i.isEmpty()){var s=this._series.firstValue();if(null!==s){var h=this.ii.options();t.visible=!0,t.y=i.priceToCoordinate(h.price,s.value),t.color=h.color,t.width=n.width(),t.height=i.height(),t.lineWidth=h.lineWidth,t.lineStyle=h.lineStyle}}},i}(qt),ui=function(){function t(t,i){this.ti=t,this.K=i,this.ni=new ri(t,this)}return t.prototype.applyOptions=function(t){c(this.K,t),this.update(),this.ti.model().lightUpdate()},t.prototype.options=function(){return this.K},t.prototype.paneView=function(){return this.ni},t.prototype.update=function(){this.ni.update()},t}(),ei=function(){function t(){this.si=0,this.hi=new Map,this.ri=new Map}return t.prototype.colorByIndex=function(t){return o(this.ri.get(t))},t.prototype.addColor=function(t){var i=this.hi.get(t);return void 0===i&&(i=this.si++,this.hi.set(t,i),this.ri.set(i,t)),i},t.prototype.clear=function(){this.si=0,this.hi.clear(),this.ri.clear()},t.prototype.size=function(){return this.ri.size},t}(),oi={barColor:"",barBorderColor:"",barWickColor:""},fi=function(){function t(t){this.ti=t}return t.prototype.barStyle=function(t,i){var n=this.ti.seriesType(),s=this.ti.options();switch(n){case"Line":return this.ui(s);case"Area":return this.ei(s);case"Bar":return this.oi(s,t,i);case"Candlestick":return this.fi(s,t,i);case"Histogram":return this.ai(s,t,i)}throw new Error("Unknown chart style")},t.prototype.oi=function(t,i,n){var s=u({},oi),h=t.upColor,r=t.downColor,e=h,o=r,c=f(this.ci(i,n)),l=a(c.value[0])<=a(c.value[3]);return s.barColor=l?h:r,s.barBorderColor=l?e:o,s},t.prototype.fi=function(t,i,n){var s=u({},oi),h=t.upColor,r=t.downColor,e=t.borderUpColor,o=t.borderDownColor,c=t.wickUpColor,l=t.wickDownColor,v=f(this.ci(i,n)),d=a(v.value[0])<=a(v.value[3]);return s.barColor=d?h:r,s.barBorderColor=d?e:o,s.barWickColor=d?c:l,s},t.prototype.ei=function(t){return u(u({},oi),{barColor:t.lineColor})},t.prototype.ui=function(t){return u(u({},oi),{barColor:t.color})},t.prototype.ai=function(t,i,n){var s=u({},oi),h=f(this.ci(i,n)).value[4];if(null!=h){var r=f(this.ti.palette());s.barColor=r.colorByIndex(h)}else s.barColor=t.color;return s},t.prototype.li=function(){return this.ti.bars()},t.prototype.ci=function(t,i){return void 0!==i?i.value:this.li().valueAt(t)},t}();!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.Exact=0]="Exact",t[t.NearestRight=1]="NearestRight"}(ii||(ii={}));var ai,ci=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.vi=[],this.di=0,this.wi=0,this.bi=!1,this.mi=new Map,this.Mi=new Map,this.pi=new Map,this.gi=t||new Map,this.yi=i}return t.prototype.clear=function(){this.vi=[],this.di=0,this.wi=0,this.bi=!1,this.mi.clear(),this.Mi.clear(),this.pi.clear()},t.prototype.first=function(){return this.size()>0?this.vi[this.di]:null},t.prototype.last=function(){return this.size()>0?this.vi[this.wi-1]:null},t.prototype.firstIndex=function(){return this.size()>0?this.ki(this.di):null},t.prototype.lastIndex=function(){return this.size()>0?this.ki(this.wi-1):null},t.prototype.size=function(){return this.wi-this.di},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.contains=function(t){return null!==this.Ni(t,0)},t.prototype.valueAt=function(t){return this.search(t)},t.prototype.add=function(t,i,n){if(this.bi)return!1;var s={index:t,value:n,time:i},h=this.Ni(t,0);return this.Mi.clear(),this.pi.clear(),null===h?(this.vi.splice(this.Si(t),0,s),this.di=0,this.wi=this.vi.length,!0):(this.vi[h]=s,!1)},t.prototype.search=function(t,i,n){void 0===i&&(i=0);var s=this.Ni(t,i,n);if(null===s)return null;var h=this.xi(s);return{index:this.ki(s),time:h.time,value:h.value}},t.prototype.each=function(t){for(var i=this.di;i<this.wi;++i){if(t(this.ki(i),this.xi(i)))break}},t.prototype.range=function(i,n){var s=new t(this.gi,this.yi);return s.vi=this.vi,s.di=this.Si(i),s.wi=this.Ci(n),s.bi=!0,s},t.prototype.minMaxOnRangeCached=function(t,i,n){if(this.isEmpty())return null;for(var s=null,h=0,r=n;h<r.length;h++){var u=r[h];s=li(s,this.Di(t,i,u))}return s},t.prototype.merge=function(t){return this.bi?null:0===t.length?null:this.isEmpty()||t[t.length-1].index<this.vi[0].index?this.Ei(t):t[0].index>this.vi[this.vi.length-1].index?this.Ti(t):1===t.length&&t[0].index===this.vi[this.vi.length-1].index?(this.Ai(t[0]),t[0]):this.Li(t)},t.prototype.remove=function(t){if(this.bi)return null;var i=this.Ni(t,1);if(null===i)return null;var n=this.vi.splice(i);return this.wi=this.vi.length,this.mi.clear(),this.Mi.clear(),this.pi.clear(),n.length>0?n[0]:null},t.prototype.ki=function(t){return this.vi[t].index},t.prototype.xi=function(t){return this.vi[t]},t.prototype.Ni=function(t,i,n){var s=this.Bi(t);if(null===s&&0!==i)switch(i){case-1:return this.zi(t,n);case 1:return this.Fi(t,n);default:throw new TypeError("Unknown search mode")}if(!n||null===s||0===i)return s;switch(i){case-1:return this.Vi(s);case 1:return this.Oi(s);default:throw new TypeError("Unknown search mode")}},t.prototype.Oi=function(t){for(var i=f(this.yi);t<this.wi&&i(this.xi(t).value);)t+=1;return t===this.wi?null:t},t.prototype.Vi=function(t){for(var i=f(this.yi);t>=this.di&&i(this.xi(t).value);)t-=1;return t<this.di?null:t},t.prototype.zi=function(t,i){var n=this.Si(t);n>this.di&&(n-=1);var s=n!==this.wi&&this.ki(n)<t?n:null;return i&&null!==s?this.Vi(s):s},t.prototype.Fi=function(t,i){var n=this.Ci(t),s=n!==this.wi&&t<this.ki(n)?n:null;return i&&null!==s?this.Oi(s):s},t.prototype.Bi=function(t){var i=this.Si(t);return i===this.wi||t<this.vi[i].index?null:i},t.prototype.Si=function(t){return mt(this.vi,t,(function(t,i){return t.index<i}),this.di,this.wi)},t.prototype.Ci=function(t){return Mt(this.vi,t,(function(t,i){return i.index>t}),this.di,this.wi)},t.prototype.Ii=function(t,i,n){var s=null,h=this.gi.get(n.name);if(void 0===h)throw new Error('Plot "'+n.name+'" is not registered');for(var r=t;r<i;r++){var u=h(this.vi[r].value);null==u||Number.isNaN(u)||(null===s?s={min:u,max:u}:(u<s.min&&(s.min=u),u>s.max&&(s.max=u)))}return s},t.prototype.Pi=function(t){var i=Math.floor(t.index/30);this.mi.forEach((function(t){return t.delete(i)}))},t.prototype.Ei=function(t){return e(!this.bi,"collection should not be readonly"),e(0!==t.length,"plotRows should not be empty"),this.Mi.clear(),this.pi.clear(),this.mi.clear(),this.vi=t.concat(this.vi),this.di=0,this.wi=this.vi.length,t[0]},t.prototype.Ti=function(t){return e(!this.bi,"collection should not be readonly"),e(0!==t.length,"plotRows should not be empty"),this.Mi.clear(),this.pi.clear(),this.mi.clear(),this.vi=this.vi.concat(t),this.di=0,this.wi=this.vi.length,t[0]},t.prototype.Ai=function(t){e(!this.isEmpty(),"plot list should not be empty"),e(this.vi[this.wi-1].index===t.index,"last row index should match new row index"),this.Pi(t),this.Mi.delete(t.index),this.pi.delete(t.index),this.vi[this.wi-1]=t},t.prototype.Li=function(t){return e(0!==t.length,"plot rows should not be empty"),this.Mi.clear(),this.pi.clear(),this.mi.clear(),this.vi=function(t,i){var n=function(t,i){var n=t.length,s=i.length,h=n+s,r=0,u=0;for(;r<n&&u<s;)t[r].index<i[u].index?r++:t[r].index>i[u].index?u++:(r++,u++,h--);return h}(t,i),s=new Array(n),h=0,r=0,u=t.length,e=i.length,o=0;for(;h<u&&r<e;)t[h].index<i[r].index?(s[o]=t[h],h++):t[h].index>i[r].index?(s[o]=i[r],r++):(s[o]=i[r],h++,r++),o++;for(;h<u;)s[o]=t[h],h++,o++;for(;r<e;)s[o]=i[r],r++,o++;return s}(this.vi,t),this.di=0,this.wi=this.vi.length,t[0]},t.prototype.Di=function(t,i,n){if(this.isEmpty())return null;var s=null,h=f(this.firstIndex()),r=f(this.lastIndex()),u=t-n.offset,e=i-n.offset;u=Math.max(u,h),e=Math.min(e,r);var o=30*Math.ceil(u/30),a=Math.max(o,30*Math.floor(e/30)),c=this.Si(u),l=this.Ci(Math.min(e,o,i));s=li(s,this.Ii(c,l,n));var v=this.mi.get(n.name);void 0===v&&(v=new Map,this.mi.set(n.name,v));for(var d=Math.max(o+1,u);d<a;d+=30){var w=Math.floor(d/30),b=v.get(w);if(void 0===b){var m=this.Si(30*w),M=this.Ci(30*(w+1)-1);b=this.Ii(m,M,n),v.set(w,b)}s=li(s,b)}c=this.Si(a),l=this.Ci(e);return s=li(s,this.Ii(c,l,n))},t}();function li(t,i){return null===t?i:null===i?t:{min:Math.min(t.min,i.min),max:Math.max(t.max,i.max)}}!function(t){t[t.Open=0]="Open",t[t.High=1]="High",t[t.Low=2]="Low",t[t.Close=3]="Close",t[t.Color=4]="Color"}(ai||(ai={}));var vi={open:function(t){return t[0]},high:function(t){return t[1]},low:function(t){return t[2]},close:function(t){return t[3]},hl2:function(t){return(t[1]+t[2])/2},hlc3:function(t){return(t[1]+t[2]+t[3])/3},ohlc4:function(t){return(t[0]+t[1]+t[2]+t[3])/4}},di=["open","high","low","close","hl2","hlc3","ohlc4"];function wi(t){return vi[t]}var bi,mi=function(){function t(){var t;this.Ri=new ci((t=new Map,di.forEach((function(i,n){t.set(i,wi(i))})),t))}return t.prototype.bars=function(){return this.Ri},t.prototype.size=function(){return this.Ri.size()},t.prototype.each=function(t){this.Ri.each(t)},t.prototype.clear=function(){this.Ri.clear()},t.prototype.isEmpty=function(){return this.Ri.isEmpty()},t.prototype.first=function(){return this.Ri.first()},t.prototype.last=function(){return this.Ri.last()},t.prototype.search=function(t,i){return this.bars().search(t,i)},t.prototype.valueAt=function(t){return this.search(t)},t}(),Mi=function(t){function i(i,n,s){var h=t.call(this,i)||this;h.M=new mi,h.ni=new si(h),h.Wi=[],h.qi=new Ut(h),h.Ui=!1,h.ji=null,h.Hi=new ei,h.Yi=[],h._i=[],h.K=n,h.Ki=s;var r=new hi(h,{model:i});return h.q=[r],h.$i=new Rt(r,h,i),h.Xi(),h.Zi(),h.Ji=h.barFunction(),h.Gi(),h}return r(i,t),i.prototype.destroy=function(){},i.prototype.endOfData=function(){return this.Ui},i.prototype.priceLineColor=function(t){return this.K.priceLineColor||t},i.prototype.lastValueData=function(t,i,n){var s={noData:!0},h=this.priceScale();if(this.model().timeScale().isEmpty()||h.isEmpty()||this.data().isEmpty())return s;var r,u,e=this.model().timeScale().visibleBars(),o=this.firstValue();if(null===e||null===o)return s;if(i){var f=this.data().bars().last();if(null===f)return s;r=f,u=f.index}else{var a=this.data().bars().search(e.lastBar(),-1);if(null===a)return s;if(null===(r=this.data().bars().valueAt(a.index)))return s;u=a.index}var c=void 0!==t?r.value[t]:this.Ji(r.value),l=this.barColorer().barStyle(u,{value:r}),v=h.priceToCoordinate(c,o.value,!0);return{noData:!1,price:n?c:void 0,text:h.formatPrice(c,o.value),formattedPriceAbsolute:h.formatPriceAbsolute(c),formattedPricePercentage:h.formatPricePercentage(c,o.value),color:l.barColor,floatCoordinate:v,coordinate:Math.round(v),index:u}},i.prototype.data=function(){return this.M},i.prototype.barColorer=function(){return null!==this.ji?this.ji:(this.ji=new fi(this),this.ji)},i.prototype.options=function(){return this.K},i.prototype.applyOptions=function(t){var i=this.K.overlay;c(this.K,t),this.K.overlay=i,i&&null!==this._priceScale&&void 0!==t.scaleMargins&&this._priceScale.applyOptions({scaleMargins:this.K.scaleMargins}),void 0!==t.priceFormat&&this.Xi(),this.model().updateSource(this)},i.prototype.clearData=function(){this.M.clear(),this.Hi.clear(),this.Gi()},i.prototype.updateData=function(t){this.M.bars().merge(t),this.Qi(),this.J.update("data"),this.$.update("data");var i=this.model().paneForSource(this);this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.setMarkers=function(t){this.Yi=t.map((function(t){return u({},t)})),this.Qi();var i=this.model().paneForSource(this);this.$.update("data"),this.model().recalculatePane(i),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},i.prototype.markers=function(){return this.Yi},i.prototype.indexedMarkers=function(){return this._i},i.prototype.createPriceLine=function(t){var i=new ui(this,t);return this.Wi.push(i),this.model().updateSource(this),i},i.prototype.removePriceLine=function(t){var i=this.Wi.indexOf(t);-1!==i&&this.Wi.splice(i,1)},i.prototype.palette=function(){return this.Hi},i.prototype.seriesType=function(){return this.Ki},i.prototype.firstValue=function(){var t=this.firstBar();return null===t?null:{value:this.Ji(t.value),timePoint:t.time}},i.prototype.firstBar=function(){var t=this.model().timeScale().visibleBars();if(null===t)return null;var i=t.firstBar();return this.data().search(i,1)},i.prototype.bars=function(){return this.M.bars()},i.prototype.nearestIndex=function(t,i){var n=this.nearestData(t,i);return n?n.index:null},i.prototype.nearestData=function(t,i){return v(t)?this.data().search(t,i):null},i.prototype.dataAt=function(t){var i=this.data().valueAt(t);return null===i?null:"Bar"===this.Ki||"Candlestick"===this.Ki?{open:i.value[0],high:i.value[1],low:i.value[2],close:i.value[3]}:this.barFunction()(i.value)},i.prototype.paneViews=function(){var t=[];this.priceScale()===this.model().mainPriceScale()&&t.push(this.qi);for(var i=0,n=this.Wi;i<n.length;i++){var s=n[i];t.push(s.paneView())}return t.push(this.J),t.push(this.ni),t.push(this.$i),t.push(this.$),t},i.prototype.priceAxisViews=function(t,i){return this.q},i.prototype.autoscaleInfo=function(t,i){if(!v(t)||!v(i)||this.data().isEmpty())return null;var n,s="Line"===this.Ki||"Area"===this.Ki||"Histogram"===this.Ki?"close":null,h=null!==(n=null!==s?this.data().bars().minMaxOnRangeCached(t,i,[{name:s,offset:0}]):this.data().bars().minMaxOnRangeCached(t,i,[{name:"low",offset:0},{name:"high",offset:0}]))?new tt(n.min,n.max):null;if("Histogram"===this.seriesType()){var r=this.K.base,u=new tt(r,r);h=null!==h?h.merge(u):u}return{priceRange:h,margins:this.$.autoScaleMargins()}},i.prototype.minMove=function(){return this.K.priceFormat.minMove},i.prototype.formatter=function(){return this.tn},i.prototype.barFunction=function(){return this.Ji},i.prototype.updateAllViews=function(){this.J.update(),this.$.update();for(var t=0,i=this.q;t<i.length;t++){i[t].update()}for(var n=0,s=this.Wi;n<s.length;n++){s[n].update()}this.ni.update(),this.qi.update()},i.prototype.setPriceScale=function(t){this._priceScale!==t&&(this._priceScale=t)},i.prototype.priceScale=function(){return f(this._priceScale)},i.prototype.markerDataAtIndex=function(t){if(!(("Line"===this.Ki||"Area"===this.Ki)&&this.K.crosshairMarkerVisible))return null;var i=this.M.valueAt(t);return null===i?null:{price:this.Ji(i.value),radius:this.in()}},i.prototype.title=function(){return this.K.title},i.prototype.in=function(){switch(this.Ki){case"Line":case"Area":return this.K.crosshairMarkerRadius}return 0},i.prototype.Xi=function(){switch(this.K.priceFormat.type){case"custom":this.tn={format:this.K.priceFormat.formatter};break;case"volume":this.tn=new vt(this.K.priceFormat.precision);break;case"percent":this.tn=new J(this.K.priceFormat.precision);break;default:var t=Math.pow(10,this.K.priceFormat.precision);this.tn=new Z(t,this.K.priceFormat.minMove*t,!1,void 0)}null!==this._priceScale&&this._priceScale.updateFormatter()},i.prototype.Zi=function(){this.Ji=wi("close")},i.prototype.Qi=function(){var t=this.model().timeScale().points();this._i=this.Yi.map((function(i,n){return{time:f(t.indexOf(i.time.timestamp,!0)),position:i.position,shape:i.shape,color:i.color,id:i.id,internalId:n}}))},i.prototype.Gi=function(){switch(this.$=new ni(this,this.model()),this.Ki){case"Bar":this.J=new Tt(this,this.model());break;case"Candlestick":this.J=new Lt(this,this.model());break;case"Line":this.J=new Vt(this,this.model());break;case"Area":this.J=new St(this,this.model());break;case"Histogram":this.J=new Ft(this,this.model());break;default:throw Error("Unknown chart style assigned: "+this.Ki)}},i}(Q);function pi(t){return t.slice().sort((function(t,i){return f(t.zorder())-f(i.zorder())}))}!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(bi||(bi={}));var gi=new J,yi=new Z(100,1),ki=function(){function t(t,i,n){this.nn=0,this.sn=null,this.hn=new G,this.rn=null,this.un=null,this.en=new G,this.on={isValid:!1,visibleBars:null},this.fn=0,this.an=0,this.cn=new G,this.ln=new G,this.vn=[],this.dn=null,this.wn=!1,this.bn=null,this.mn=null,this.Mn=null,this.pn=null,this.tn=yi,this.gn=new G,this.K=t,this.yn=i,this.kn=n,this.Nn=new lt(this,100,this.Sn.bind(this),this.xn.bind(this))}return t.prototype.options=function(){return this.K},t.prototype.applyOptions=function(t){if(c(this.K,t),this.updateFormatter(),void 0!==t.mode&&this.setMode({mode:t.mode}),this.gn.fire(),void 0!==t.scaleMargins){var i=o(t.scaleMargins.top),n=o(t.scaleMargins.bottom);if(i<0||i>1)throw new Error("Invalid top margin - expect value between 0 and 1, given="+i);if(n<0||n>1||i+n>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given="+n);if(i+n>1)throw new Error("Invalid margins - sum of margins must be less than 1, given="+(i+n));this.Cn(),this.mn=null}},t.prototype.optionsChanged=function(){return this.gn},t.prototype.isAutoScale=function(){return this.K.autoScale},t.prototype.isLog=function(){return 1===this.K.mode},t.prototype.isPercentage=function(){return 2===this.K.mode},t.prototype.isIndexedTo100=function(){return 3===this.K.mode},t.prototype.mode=function(){return{autoScale:this.K.autoScale,isInverted:this.K.invertScale,mode:this.K.mode}},t.prototype.setMode=function(t){var i=this.mode(),n=null;void 0!==t.autoScale&&(this.K.autoScale=t.autoScale),void 0!==t.mode&&(this.K.mode=t.mode,2!==t.mode&&3!==t.mode||(this.K.autoScale=!0),this.on.isValid=!1),1===i.mode&&t.mode!==i.mode&&(!function(t){if(null===t)return!1;var i=ft(t.minValue()),n=ft(t.maxValue());return isFinite(i)&&isFinite(n)}(this.rn)?this.K.autoScale=!0:null!==(n=function(t){if(null===t)return null;var i=ft(t.minValue()),n=ft(t.maxValue());return new tt(i,n)}(this.rn))&&this.setPriceRange(n)),1===t.mode&&t.mode!==i.mode&&null!==(n=at(this.rn))&&this.setPriceRange(n);var s=i.mode!==this.K.mode;s&&(2===i.mode||this.isPercentage())&&this.updateFormatter(),s&&(3===i.mode||this.isIndexedTo100())&&this.updateFormatter(),void 0!==t.isInverted&&i.isInverted!==t.isInverted&&(this.K.invertScale=t.isInverted,this.Dn()),this.ln.fire(i,this.mode())},t.prototype.modeChanged=function(){return this.ln},t.prototype.fontSize=function(){return this.yn.fontSize},t.prototype.height=function(){return this.nn},t.prototype.setHeight=function(t){this.nn!==t&&(this.nn=t,this.Cn(),this.mn=null)},t.prototype.internalHeight=function(){if(this.sn)return this.sn;var t=this.height()-this.En()-this.Tn();return this.sn=t,t},t.prototype.internalHeightChanged=function(){return this.hn},t.prototype.priceRange=function(){return this.An(),this.rn},t.prototype.priceRangeChanged=function(){return this.en},t.prototype.setPriceRange=function(t,i,n){var s=this.rn;(i||null===s&&null!==t||null!==s&&!s.equals(t))&&(this.mn=null,this.rn=t,n||this.en.fire(s,t))},t.prototype.isEmpty=function(){return this.An(),0===this.nn||!this.rn||this.rn.isEmpty()},t.prototype.invertedCoordinate=function(t){return this.isInverted()?t:this.height()-1-t},t.prototype.priceToCoordinate=function(t,i,n){return this.isPercentage()?t=ht(t,i):this.isIndexedTo100()&&(t=ut(t,i)),this.xn(t,i,n)},t.prototype.pointsArrayToCoordinates=function(t,i,n){this.An();for(var s=this.Tn(),h=f(this.priceRange()),r=h.minValue(),u=h.maxValue(),e=this.internalHeight()-1,o=this.isInverted(),a=e/(u-r),c=void 0===n?0:n.from,l=void 0===n?t.length:n.to,v=this.Ln(),d=c;d<l;d++){var w=t[d],b=w.price;if(!isNaN(b)){var m=b;null!==v&&(m=v(w.price,i));var M=s+a*(m-r),p=o?M:this.nn-1-M;w.y=Math.round(p)}}},t.prototype.barPricesToCoordinates=function(t,i,n){this.An();for(var s=this.Tn(),h=f(this.priceRange()),r=h.minValue(),u=h.maxValue(),e=this.internalHeight()-1,o=this.isInverted(),a=e/(u-r),c=void 0===n?0:n.from,l=void 0===n?t.length:n.to,v=this.Ln(),d=c;d<l;d++){var w=t[d],b=w.open,m=w.high,M=w.low,p=w.close;null!==v&&(b=v(w.open,i),m=v(w.high,i),M=v(w.low,i),p=v(w.close,i));var g=s+a*(b-r),y=o?g:this.nn-1-g;w.openY=Math.round(y),g=s+a*(m-r),y=o?g:this.nn-1-g,w.highY=Math.round(y),g=s+a*(M-r),y=o?g:this.nn-1-g,w.lowY=Math.round(y),g=s+a*(p-r),y=o?g:this.nn-1-g,w.closeY=Math.round(y)}},t.prototype.coordinateToPrice=function(t,i){var n=this.Sn(t,i);return this.logicalToPrice(n,i)},t.prototype.logicalToPrice=function(t,i){var n=t;return this.isPercentage()?n=function(t,i){return i<0&&(t=-t),t/100*i+i}(n,i):this.isIndexedTo100()&&(n=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(n,i)),n},t.prototype.dataSources=function(){return this.vn},t.prototype.orderedSources=function(){if(this.dn)return this.dn;for(var t=[],i=0;i<this.vn.length;i++){var n=this.vn[i];null===n.zorder()&&n.setZorder(i+1),t.push(n)}return t=pi(t),this.dn=t,this.dn},t.prototype.hasSeries=function(){return this.wn},t.prototype.addDataSource=function(t){-1===this.vn.indexOf(t)&&(t instanceof Mi&&(this.wn=!0),this.vn.push(t),this.bn=null,this.updateFormatter(),this.invalidateSourcesCache())},t.prototype.removeDataSource=function(t){var i=this.vn.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.vn.splice(i,1),t instanceof Mi&&(this.wn=!1),this.mainSource()||this.setMode({autoScale:!0}),this.bn=null,this.updateFormatter(),this.invalidateSourcesCache()},t.prototype.mainSource=function(){if(null!==this.bn)return this.bn;for(var t=null,i=0;i<this.vn.length;i++){var n=this.vn[i];if(n instanceof Mi){t=n;break}null===t&&n instanceof Q&&(t=n)}return this.bn=t,this.bn},t.prototype.firstValue=function(){for(var t=null,i=0,n=this.vn;i<n.length;i++){var s=n[i];if(s instanceof Q){var h=s.firstValue();if(null===h)continue;(null===t||h.timePoint<t.timePoint)&&(t=h)}}return null===t?null:t.value},t.prototype.isInverted=function(){return this.K.invertScale},t.prototype.marks=function(){return this.mn?this.mn:(this.Nn.rebuildTickMarks(),this.mn=this.Nn.marks(),this.cn.fire(),this.mn)},t.prototype.onMarksChanged=function(){return this.cn},t.prototype.startScale=function(t){this.isPercentage()||this.isIndexedTo100()||null===this.Mn&&null===this.un&&(this.isEmpty()||(this.Mn=this.nn-t,this.un=f(this.priceRange()).clone()))},t.prototype.scaleTo=function(t){if(!this.isPercentage()&&!this.isIndexedTo100()&&null!==this.Mn){this.setMode({autoScale:!1}),(t=this.nn-t)<0&&(t=0);var i=(this.Mn+.2*(this.nn-1))/(t+.2*(this.nn-1)),n=f(this.un).clone();i=Math.max(i,.1),n.scaleAroundCenter(i),this.setPriceRange(n)}},t.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this.Mn=null,this.un=null)},t.prototype.startScroll=function(t){this.isAutoScale()||null===this.pn&&null===this.un&&(this.isEmpty()||(this.pn=t,this.un=f(this.priceRange()).clone()))},t.prototype.scrollTo=function(t){if(!this.isAutoScale()&&null!==this.pn){var i=f(this.priceRange()).length()/(this.internalHeight()-1),n=t-this.pn;this.isInverted()&&(n*=-1);var s=n*i,h=f(this.un).clone();h.shift(s),this.setPriceRange(h,!0),this.mn=null}},t.prototype.endScroll=function(){this.isAutoScale()||null!==this.pn&&(this.pn=null,this.un=null)},t.prototype.formatter=function(){return this.tn||this.updateFormatter(),this.tn},t.prototype.formatPrice=function(t,i){switch(this.K.mode){case 2:return this.formatter().format(ht(t,i));case 3:return this.formatter().format(ut(t,i));default:return this.Bn(t)}},t.prototype.formatLogical=function(t){switch(this.K.mode){case 2:case 3:return this.formatter().format(t);default:return this.Bn(t)}},t.prototype.formatPriceAbsolute=function(t){return this.Bn(t,this.zn())},t.prototype.formatPricePercentage=function(t,i){return t=ht(t,i),gi.format(t)},t.prototype.sourcesForAutoScale=function(){return this.vn.filter((function(t){return t instanceof Q}))},t.prototype.recalculatePriceRange=function(t){this.on={visibleBars:t,isValid:!1}},t.prototype.updateAllViews=function(){this.vn.forEach((function(t){return t.updateAllViews()}))},t.prototype.updateFormatter=function(){this.mn=null;var t=this.mainSource(),i=100;null!==t&&(i=Math.round(1/t.minMove())),this.tn=yi,this.isPercentage()?(this.tn=gi,i=100):this.isIndexedTo100()?(this.tn=new Z(100,1),i=100):null!==t&&(this.tn=t.formatter()),this.Nn=new lt(this,i,this.Sn.bind(this),this.xn.bind(this)),this.Nn.rebuildTickMarks()},t.prototype.invalidateSourcesCache=function(){this.dn=null},t.prototype.En=function(){return this.isInverted()?this.K.scaleMargins.bottom*this.height()+this.an:this.K.scaleMargins.top*this.height()+this.fn},t.prototype.Tn=function(){return this.isInverted()?this.K.scaleMargins.top*this.height()+this.fn:this.K.scaleMargins.bottom*this.height()+this.an},t.prototype.An=function(){this.on.isValid||(this.on.isValid=!0,this.Fn())},t.prototype.Cn=function(){this.sn=null,this.hn.fire()},t.prototype.xn=function(t,i,n){if(this.An(),this.isEmpty())return 0;t=this.isLog()&&t?ot(t):t;var s=f(this.priceRange()),h=this.Tn()+(this.internalHeight()-1)*(t-s.minValue())/s.length(),r=this.invertedCoordinate(h);return n?r:Math.round(r)},t.prototype.Sn=function(t,i){if(this.An(),this.isEmpty())return 0;var n=this.invertedCoordinate(t),s=f(this.priceRange()),h=s.minValue()+s.length()*((n-this.Tn())/(this.internalHeight()-1));return this.isLog()?ft(h):h},t.prototype.Dn=function(){this.mn=null,this.Nn.rebuildTickMarks()},t.prototype.zn=function(){return f(this.mainSource()).formatter()},t.prototype.Fn=function(){var t=this.on.visibleBars;if(null!==t){for(var i=null,n=0,s=0,h=0,r=this.sourcesForAutoScale();h<r.length;h++){var u=r[h],e=u.firstValue();if(null!==e){var o=u.autoscaleInfo(t.firstBar(),t.lastBar()),a=o&&o.priceRange;if(null!==a){switch(this.K.mode){case 1:a=at(a);break;case 2:a=rt(a,e.value);break;case 3:a=et(a,e.value)}i=null===i?a:i.merge(f(a)),null!==o&&null!==o.margins&&(n=Math.max(n,o.margins.above),s=Math.max(n,o.margins.below))}}}if(n===this.fn&&s===this.an||(this.fn=n,this.an=s,this.mn=null,this.Cn()),null!==i){if(i.minValue()===i.maxValue()){var c=this.mainSource(),l=5*(null===c||this.isPercentage()||this.isIndexedTo100()?1:c.minMove());i=new tt(i.minValue()-l,i.maxValue()+l)}this.setPriceRange(i)}else null===this.rn&&this.setPriceRange(new tt(-.5,.5));this.on.isValid=!0}},t.prototype.Ln=function(){return this.isPercentage()?ht:this.isIndexedTo100()?ut:this.isLog()?ot:null},t.prototype.Bn=function(t,i){return void 0===this.kn.priceFormatter?(void 0===i&&(i=this.formatter()),i.format(t)):this.kn.priceFormatter(t)},t}();function Ni(t){return!l(t)&&!d(t)}function Si(t){return l(t)}var xi,Ci="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function Di(t,i,n){return void 0!==n?n+=" ":n="",void 0===i&&(i=Ci),""+n+t+"px "+i}!function(t){t[t.BorderSize=1]="BorderSize",t[t.TickLength=4]="TickLength",t[t.OffsetSize=1]="OffsetSize"}(xi||(xi={}));var Ei,Ti=function(){function t(t){this.Ht={borderSize:1,tickLength:4,offsetSize:1,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this.l=t}return t.prototype.options=function(){var t=this.Ht,i=this.Zt(),n=this.Vn();return t.fontSize===i&&t.fontFamily===n||(t.fontSize=i,t.fontFamily=n,t.font=Di(i,n),t.paddingTop=Math.floor(i/3.5),t.paddingBottom=t.paddingTop,t.paddingInner=Math.max(Math.ceil(i/2-t.tickLength/2),0),t.paddingOuter=Math.ceil(i/2+t.tickLength/2),t.baselineOffset=Math.round(i/5)),t.color=this.On(),this.Ht},t.prototype.On=function(){return this.l.options().layout.textColor},t.prototype.Zt=function(){return this.l.options().layout.fontSize},t.prototype.Vn=function(){return this.l.options().layout.fontFamily},t}(),Ai=function(){function t(){this.M=null}return t.prototype.setData=function(t){this.M=t},t.prototype.draw=function(t){if(null!==this.M){if(t.lineWidth=1,this.M.vertLinesVisible){t.strokeStyle=this.M.vertLinesColor,s(t,this.M.vertLineStyle),t.beginPath();for(var i=0,n=this.M.timeMarks;i<n.length;i++){var h=n[i];t.moveTo(h.coord+1,0),t.lineTo(h.coord+1,this.M.h)}t.stroke()}if(this.M.horzLinesVisible){t.strokeStyle=this.M.horzLinesColor,s(t,this.M.horzLineStyle),t.beginPath();for(var r=0,u=this.M.priceMarks;r<u.length;r++){var e=u[r];t.moveTo(0,e.coord),t.lineTo(this.M.w,e.coord)}t.stroke()}}},t}(),Li=function(){function t(t){this.g=new Ai,this.o=!0,this.I=t}return t.prototype.update=function(){this.o=!0},t.prototype.renderer=function(t,i){if(this.o){var n=this.I.model().options().grid,s={h:t,w:i,horzLinesVisible:n.horzLines.visible,vertLinesVisible:n.vertLines.visible,horzLinesColor:n.horzLines.color,vertLinesColor:n.vertLines.color,horzLineStyle:n.horzLines.style,vertLineStyle:n.vertLines.style,priceMarks:this.I.defaultPriceScale().marks(),timeMarks:this.I.model().timeScale().marks()||[]};this.g.setData(s),this.o=!1}return this.g},t}(),Bi=function(){function t(){this.In=new WeakMap,this.o=!0}return t.prototype.paneViews=function(t){var i=this.In.get(t);return void 0===i&&(i=[new Li(t)],this.In.set(t,i)),this.o&&(i.forEach((function(t){return t.update()})),this.o=!1),i},t.prototype.invalidate=function(){this.o=!0},t}();!function(t){t[t.None=0]="None",t[t.Cursor=1]="Cursor",t[t.Light=2]="Light",t[t.Full=3]="Full"}(Ei||(Ei={}));var zi=function(){function t(t){this.Pn=new Map,this.Rn=!1,this.Wn=!1,this.qn=null,this.Un=t}return t.prototype.invalidatePane=function(t,i){var n=function(t,i){return void 0===t?i:{level:Math.max(t.level,i.level),autoScale:t.autoScale||i.autoScale}}(this.Pn.get(t),i);this.Pn.set(t,n)},t.prototype.invalidateAll=function(t){this.Un=Math.max(this.Un,t)},t.prototype.fullInvalidation=function(){return this.Un},t.prototype.invalidateForPane=function(t){var i=this.Pn.get(t);return void 0===i?{level:this.Un}:{level:Math.max(this.Un,i.level),autoScale:i.autoScale}},t.prototype.setFitContent=function(){this.Wn=!0,this.qn=null},t.prototype.getFitContent=function(){return this.Wn},t.prototype.setTargetTimeRange=function(t){this.qn=t,this.Wn=!1},t.prototype.getTargetTimeRange=function(){return this.qn},t.prototype.merge=function(t){var i=this;this.Rn=this.Rn||t.Rn,t.Wn&&this.setFitContent(),t.qn&&this.setTargetTimeRange(t.qn),this.Un=Math.max(this.Un,t.Un),t.Pn.forEach((function(t,n){i.invalidatePane(n,t)}))},t}(),Fi=function(){function t(t){this.K=t}return t.prototype.align=function(t,i,n){var s=t;if(0===this.K.mode)return s;var h=n.defaultPriceScale(),r=h.firstValue();if(null===r)return s;var u=h.priceToCoordinate(t,r),e=n.dataSources().filter((function(t){return t instanceof Mi})).reduce((function(t,s){if(n.isOverlay(s))return t;var h=s.priceScale(),r=s.bars();if(h.isEmpty()||!r.contains(i))return t;var u=r.valueAt(i);if(null===u)return t;var e=[u.value[3]],o=a(s.firstValue());return t.concat(e.map((function(t){return h.priceToCoordinate(t,o.value,!0)})))}),[]);if(0===e.length)return s;e.sort((function(t,i){return Math.abs(t-u)-Math.abs(i-u)}));var o=e[0];return s=h.coordinateToPrice(o,r)},t}(),Vi=1e3,Oi=function(){function t(t,i){this.vn=[],this.jn=[],this.nn=0,this._t=0,this.Hn=Vi,this.Yn=null,this.dn=null,this._n=new G,this.Kn=t,this.V=i,this.model().mainPriceScaleOptionsChanged().subscribe(this.onPriceScaleOptionsChanged.bind(this),this),this.$n=this.Xn()}return t.prototype.onPriceScaleOptionsChanged=function(){this.$n.applyOptions(this.V.options().priceScale)},t.prototype.destroy=function(){this.model().mainPriceScaleOptionsChanged().unsubscribeAll(this),this.Kn.barSpacingChanged().unsubscribeAll(this),this.$n.modeChanged().unsubscribeAll(this),this.vn.forEach((function(t){t.destroy&&t.destroy()})),this._n.fire()},t.prototype.stretchFactor=function(){return this.Hn},t.prototype.setStretchFactor=function(t){this.Hn=t},t.prototype.model=function(){return this.V},t.prototype.width=function(){return this._t},t.prototype.height=function(){return this.nn},t.prototype.setWidth=function(t){this._t=t,this.updateAllViews()},t.prototype.setHeight=function(t){var i=this;this.nn=t,this.$n.setHeight(t),this.vn.forEach((function(n){if(i.isOverlay(n)){var s=n.priceScale();null!==s&&s.setHeight(t)}})),this.updateAllViews()},t.prototype.dataSources=function(){return this.vn},t.prototype.isOverlay=function(t){var i=t.priceScale();return null===i||this.$n!==i},t.prototype.addDataSource=function(t,i,n){var s=this.Zn().minZOrder-1;this.Jn(t,i,s)},t.prototype.removeDataSource=function(t){var i=this.vn.indexOf(t);e(-1!==i,"removeDataSource: invalid data source"),this.vn.splice(i,1),t===this.Yn&&(this.Yn=null);var n=this.jn.indexOf(t);-1!==n&&this.jn.splice(n,1);var s=t.priceScale();if(s&&s.dataSources().indexOf(t)>=0&&s.removeDataSource(t),s&&null===s.mainSource()){var h=s.dataSources().length;e(0===h,"Invalid priceScale state: empty mainSource but non-empty data sources="+h),s!==this.$n&&s.modeChanged().unsubscribeAll(this)}t instanceof Q&&this.Gn(),s&&t instanceof Q&&(s.invalidateSourcesCache(),this.recalculatePriceScale(s)),this.dn=null},t.prototype.priceScalePosition=function(){var t=this.V.options().priceScale.position;return"none"===t?"overlay":t},t.prototype.startScalePrice=function(t,i){t.startScale(i)},t.prototype.scalePriceTo=function(t,i){t.scaleTo(i),this.updateAllViews()},t.prototype.endScalePrice=function(t){t.endScale()},t.prototype.startScrollPrice=function(t,i){t.startScroll(i)},t.prototype.scrollPriceTo=function(t,i){t.scrollTo(i),this.updateAllViews()},t.prototype.endScrollPrice=function(t){t.endScroll()},t.prototype.setPriceAutoScale=function(t,i){t.setMode({autoScale:i}),this.Kn.isEmpty()?t.setPriceRange(null):this.recalculatePriceScale(t)},t.prototype.updateAllViews=function(){this.vn.forEach((function(t){t.updateAllViews()}))},t.prototype.defaultPriceScale=function(){var t=this.mainDataSource(),i=null!==t?t.priceScale():null;return null===i&&(i=this.$n),i},t.prototype.mainDataSource=function(){return this.Yn},t.prototype.recalculatePriceScale=function(t){null!==t&&t.isAutoScale()&&this.Qn(t)},t.prototype.resetPriceScale=function(t){var i=this.Kn.visibleBars();t.setMode({autoScale:!0}),null!==i&&t.recalculatePriceRange(i),this.updateAllViews()},t.prototype.momentaryAutoScale=function(){this.Qn(this.$n)},t.prototype.recalculate=function(){var t=this;this.recalculatePriceScale(this.$n),this.vn.forEach((function(i){t.isOverlay(i)&&t.recalculatePriceScale(i.priceScale())})),this.updateAllViews(),this.V.lightUpdate()},t.prototype.isEmpty=function(){return null===this.Yn},t.prototype.containsSeries=function(){return this.vn.some((function(t){return t instanceof Mi}))},t.prototype.orderedSources=function(){return null===this.dn&&(this.dn=pi(this.vn)),this.dn},t.prototype.onDestroyed=function(){return this._n},t.prototype.ts=function(t,i){return"overlay"!==i?this.$n:this.Xn(!0)},t.prototype.Qn=function(t){var i=t.sourcesForAutoScale();if(i&&i.length>0&&!this.Kn.isEmpty()){var n=this.Kn.visibleBars();null!==n&&t.recalculatePriceRange(n)}t.updateAllViews()},t.prototype.Zn=function(){var t=this.orderedSources();if(0===t.length)return{minZOrder:0,maxZOrder:0};for(var i=0,n=0,s=0;s<t.length;s++){var h=t[s].zorder();null!==h&&(h<i&&(i=h),h>n&&(n=h))}return{minZOrder:i,maxZOrder:n}},t.prototype.Jn=function(t,i,n){var s="overlay",h=null;if(!i){var r=this.model().options().priceScale.position;s="none"===r?"overlay":r}t instanceof Q&&(h=this.ts(t,s)),this.vn.push(t),i&&this.jn.push(t),null!==h&&(h.addDataSource(t),t.setPriceScale(h)),t.setZorder(n),this.Gn(),t instanceof Q&&this.recalculatePriceScale(h),this.dn=null},t.prototype.ns=function(t,i,n){i.mode!==n.mode&&this.Qn(t)},t.prototype.Gn=function(){if(null===this.Yn||-1!==this.jn.indexOf(this.Yn)){for(var t=0,i=this.vn;t<i.length;t++){if((h=i[t])instanceof Q&&!this.isOverlay(h))return void this.ss(h)}for(var n=0,s=this.jn;n<s.length;n++){var h;if((h=s[n])instanceof Q)return void this.ss(h)}}},t.prototype.ss=function(t){var i=f(t.priceScale());this.defaultPriceScale().modeChanged().unsubscribeAll(this),i.modeChanged().subscribe(this.ns.bind(this,i),this),this.Yn=t},t.prototype.Xn=function(t){var i=b(this.V.options().priceScale);t&&(i.autoScale=!0,i.mode=0);var n=new ki(i,this.V.options().layout,this.V.options().localization);return n.setHeight(this.height()),n},t}(),Ii=function(t){return t.getUTCFullYear()},Pi=function(t){return $(function(t){return t.getUTCDate()}(t),2)},Ri=function(t){return $(function(t){return t.getUTCMonth()+1}(t),2)},Wi=function(t){return $(Ii(t)%100,2)},qi=function(t){return $(Ii(t),4)},Ui={"dd MMM 'yy":function(t,i){return Pi(t)+" "+function(t,i){return new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"})}(t,i)+" '"+Wi(t)},"yyyy-MM-dd":function(t,i){return qi(t)+"-"+Ri(t)+"-"+Pi(t)},"yy-MM-dd":function(t,i){return Wi(t)+"-"+Ri(t)+"-"+Pi(t)},"yy/MM/dd":function(t,i){return Wi(t)+"/"+Ri(t)+"/"+Pi(t)},"yyyy/MM/dd":function(t,i){return qi(t)+"/"+Ri(t)+"/"+Pi(t)},"dd-MM-yyyy":function(t,i){return Pi(t)+"-"+Ri(t)+"-"+qi(t)},"dd-MM-yy":function(t,i){return Pi(t)+"-"+Ri(t)+"-"+Wi(t)},"dd/MM/yy":function(t,i){return Pi(t)+"/"+Ri(t)+"/"+Wi(t)},"dd/MM/yyyy":function(t,i){return Pi(t)+"/"+Ri(t)+"/"+qi(t)},"MM/dd/yy":function(t,i){return Ri(t)+"/"+Pi(t)+"/"+Wi(t)},"MM/dd/yyyy":function(t,i){return Ri(t)+"/"+Pi(t)+"/"+qi(t)}},ji=function(){function t(t,i){void 0===t&&(t="yyyy-MM-dd"),void 0===i&&(i="default"),this.hs=Ui[t],this.rs=i}return t.prototype.format=function(t){return this.hs(t,this.rs)},t}(),Hi=function(){function t(t){this.us=t||"%h:%m:%s"}return t.prototype.format=function(t){return this.us.replace("%h",$(t.getUTCHours(),2)).replace("%m",$(t.getUTCMinutes(),2)).replace("%s",$(t.getUTCSeconds(),2))},t}(),Yi={dateFormat:"yyyy-MM-dd",timeFormat:"%h:%m:%s",dateTimeSeparator:" ",locale:"default"},_i=function(){function t(t){void 0===t&&(t={});var i=u(u({},Yi),t);this.es=new ji(i.dateFormat,i.locale),this.os=new Hi(i.timeFormat),this.fs=i.dateTimeSeparator}return t.prototype.format=function(t){return""+this.es.format(t)+this.fs+this.os.format(t)},t}(),Ki=function(){function t(t,i){e(t<=i,"The last bar in the bars range should be greater than or equal to the first bar"),this.as=t,this.cs=i}return t.prototype.firstBar=function(){return this.as},t.prototype.lastBar=function(){return this.cs},t.prototype.count=function(){return this.cs-this.as+1},t.prototype.contains=function(t){return this.as<=t&&t<=this.cs},t.prototype.equals=function(t){return this.as===t.firstBar()&&this.cs===t.lastBar()},t}(),$i=function(){function t(t,i){void 0===i&&(i=50),this.It=0,this.Pt=1,this.Rt=1,this.qt=new Map,this.Wt=new Map,this.ls=t,this.Ut=i}return t.prototype.format=function(t){var i=this.qt.get(t.valueOf());if(void 0!==i)return i.string;if(this.It===this.Ut){var n=this.Wt.get(this.Rt);this.Wt.delete(this.Rt),this.qt.delete(o(n)),this.Rt++,this.It--}var s=this.ls(t);return this.qt.set(t.valueOf(),{string:s,tick:this.Pt}),this.Wt.set(this.Pt,t.valueOf()),this.It++,this.Pt++,s},t}();function Xi(t,i){return t.index-i.index}var Zi,Ji,Gi=function(){function t(){this.vs=1/0,this.ds=-1/0,this.ws=new Map,this.bs=[],this.ms=new G,this.qt=null,this.Ms=NaN}return t.prototype.reset=function(){this.ws.clear(),this.bs=[],this.vs=1/0,this.ds=-1/0,this.qt=null,this.ms.fire()},t.prototype.merge=function(t){for(var i=this.bs,n={},s=0,h=t;s<h.length;s++){var r=h[s],u=r.index,e=r.span,o=this.ws.get(r.index);if(o){if(o.index===r.index&&o.span===r.span){o.time=r.time;continue}this.ps(o)}this.ws.set(u,r),this.vs>u&&(this.vs=u),this.ds<u&&(this.ds=u),void 0===(f=i[e])&&(f=[],i[e]=f),f.push(r),n[e]=!0}for(e=i.length;e--;){var f;void 0!==(f=i[e])&&(0===f.length&&delete i[e],n[e]&&f.sort(Xi))}this.qt=null,this.ms.fire()},t.prototype.indexToTime=function(t){var i=this.ws.get(t);return void 0===i?null:i.time},t.prototype.nearestIndex=function(t){for(var i=this.vs,n=this.ds;n-i>2;){if(1e3*o(this.ws.get(i)).time.timestamp===t)return i;if(1e3*o(this.ws.get(n)).time.timestamp===t)return n;var s=Math.round((i+n)/2);1e3*o(this.ws.get(s)).time.timestamp>t?n=s:i=s}return i},t.prototype.build=function(t,i){var n=Math.ceil(i/t);if(this.Ms===n&&this.qt)return this.qt;this.Ms=n;for(var s=[],h=this.bs.length;h--;)if(this.bs[h]){var r=s;s=[];for(var u=r.length,e=0,f=o(this.bs[h]),a=f.length,c=1/0,l=-1/0,v=0;v<a;v++){for(var d=f[v],w=d.index;e<u;){var b=r[e],m=b.index;if(!(m<w)){c=m;break}e++,s.push(b),l=m,c=1/0}c-w>=n&&w-l>=n&&(s.push(d),l=w)}for(;e<u;e++)s.push(r[e])}return this.qt=s,this.qt},t.prototype.ps=function(t){var i=t.index;if(this.ws.get(i)===t){this.ws.delete(i),i<=this.vs&&this.vs++,i>=this.ds&&this.ds--,this.ds<this.vs&&(this.vs=1/0,this.ds=-1/0);var n=o(this.bs[t.span]),s=n.indexOf(t);-1!==s&&n.splice(s,1)}},t}(),Qi=function(){function t(){this.vi=[]}return t.prototype.clear=function(){this.vi=[]},t.prototype.size=function(){return this.vi.length},t.prototype.firstIndex=function(){return this.gs(0)},t.prototype.lastIndex=function(){return this.gs(this.vi.length-1)},t.prototype.merge=function(t,i){if(0!==i.length)if(0!==this.vi.length){var n=t;if(n<0){var s=Math.abs(n);if(i.length<s)return;this.vi=new Array(s).concat(this.vi);for(var h=0;h<i.length;++h)this.vi[t+h]=i[h]}else{for(var r=n;r<this.vi.length&&r-n<i.length;++r)this.vi[r]=i[r-n];var u=n+i.length;if(u>this.vi.length){s=u-this.vi.length;for(var e=r;e<r+s;++e)this.vi.push(i[e-n])}}}else this.vi=i},t.prototype.valueAt=function(t){var i=this.ys(t);return null!==i?this.vi[i]:null},t.prototype.indexOf=function(t,i){if(this.vi.length<1)return null;if(t>this.vi[this.vi.length-1].timestamp)return i?this.vi.length-1:null;for(var n=0;n<this.vi.length;++n){if(t===this.vi[n].timestamp)return n;if(t<this.vi[n].timestamp)return i?n:null}return null},t.prototype.closestIndexLeft=function(t){var i=this.vi;if(!i.length)return null;if(Number.isNaN(t.timestamp))return null;var n=i.length-1;if(t>=i[n])return n;var s=0,h=i[s];if(t<h)return null;if(t===h)return s;for(;n>s+1;){var r=s+n>>1,u=i[r];if(u.timestamp>t.timestamp)n=r;else{if(!(u.timestamp<t.timestamp))return u.timestamp===t.timestamp?r:null;s=r}}return s},t.prototype.gs=function(t){return 0<=t&&t<this.size()?t:null},t.prototype.ys=function(t){return 0<=t&&t<this.size()?t:null},t}();!function(t){t[t.DefaultAnimationDuration=400]="DefaultAnimationDuration",t[t.MaxBarSpacing=50]="MaxBarSpacing",t[t.MinBarSpacing=.5]="MinBarSpacing",t[t.MinVisibleBarsCount=5]="MinVisibleBarsCount"}(Zi||(Zi={})),function(t){t[t.Minute=20]="Minute",t[t.Hour=30]="Hour",t[t.Day=40]="Day",t[t.Week=50]="Week",t[t.Month=60]="Month",t[t.Year=70]="Year"}(Ji||(Ji={}));var tn=function(){function t(t,i,n){this._t=0,this.ks=null,this.Ns=new Qi,this.Ss=new G,this.pn=null,this.Mn=null,this.xs=new Gi,this.Cs=new Map,this.Ds=null,this.Es=!0,this.Ts=new G,this.As=new G,this.Ls=null,this.Bs=null,this.zs=null,this.Fs=[],this.K=i,this.kn=n,this.Vs=i.rightOffset,this.Os=nn(i.barSpacing),this.V=t,this.Is()}return t.prototype.options=function(){return this.K},t.prototype.applyLocalizationOptions=function(t){c(this.kn,t),this.Ps(),this.Is()},t.prototype.applyOptions=function(t,i){c(this.K,t),this.K.fixLeftEdge?this.Rs():this.Ls=null,void 0!==t.rightOffset&&this.setRightOffset(t.rightOffset),void 0!==t.barSpacing&&this.setBarSpacing(t.barSpacing),this.Ps(),this.Is(),this.As.fire()},t.prototype.isEmpty=function(){return 0===this._t||0===this.Ns.size()},t.prototype.visibleBars=function(){return this.Es&&(this.Es=!1,this.Ws()),this.Ds},t.prototype.tickMarks=function(){return this.xs},t.prototype.points=function(){return this.Ns},t.prototype.width=function(){return this._t},t.prototype.setWidth=function(t){if(isFinite(t)&&!(t<=0)&&this._t!==t){if(this.K.lockVisibleTimeRangeOnResize&&this._t){var i=this.Os*t/this._t;this.qs(i)}if(null!==this.Ls)if(f(this.visibleBars()).firstBar()<=this.Ls){var n=this._t-t;this.Vs-=Math.round(n/this.Os)+1}this._t=t,this.Es=!0,this.Us()}},t.prototype.indexToCoordinate=function(t,i){if(this.isEmpty()||!v(t))return 0;var n=this.baseIndex()+this.Vs-t,s=this._t-(n+.5)*this.Os;return i?s:Math.round(s)},t.prototype.indexesToCoordinates=function(t,i){for(var n=this.baseIndex(),s=void 0===i?0:i.from,h=void 0===i?t.length:i.to,r=s;r<h;r++){var u=t[r].time,e=n+this.Vs-u,o=this._t-(e+.5)*this.Os;t[r].x=Math.round(o)}},t.prototype.indexToUserTime=function(t){return this.xs.indexToTime(t)},t.prototype.coordinateToIndex=function(t){return Math.ceil(this.js(t))},t.prototype.setRightOffset=function(t){this.Es=!0,this.Vs=t,this.Us(),this.V.recalculateAllPanes(),this.V.lightUpdate()},t.prototype.barSpacing=function(){return this.Os},t.prototype.setBarSpacing=function(t){this.qs(t),this.Us()},t.prototype.barSpacingChanged=function(){return this.Ss},t.prototype.rightOffset=function(){return this.Vs},t.prototype.marks=function(){if(this.isEmpty())return null;if(null!==this.zs)return this.zs;for(var t=this.Os,i=5*(this.V.options().layout.fontSize+4),n=Math.round(i/t),s=f(this.visibleBars()),h=Math.max(s.firstBar(),s.firstBar()-n),r=Math.max(s.lastBar(),s.lastBar()-n),u=0,e=0,o=this.xs.build(t,i);e<o.length;e++){var a=o[e];if(h<=a.index&&a.index<=r){var c=this.xs.indexToTime(a.index);if(null!==c){if(u<this.Fs.length){var l=this.Fs[u];l.coord=this.indexToCoordinate(a.index),l.label=this.Hs(c,a.span),l.span=a.span,l.major=!1}else this.Fs.push({coord:this.indexToCoordinate(a.index),label:this.Hs(c,a.span),span:a.span,major:!1});u++}}}return this.Fs.length=u,this.zs=this.Fs,this.Fs},t.prototype.reset=function(){this.Es=!0,this.Ns=new Qi,this.pn=null,this.Mn=null,this.Ys(),this.xs.reset(),this.Ls=null},t.prototype.restoreDefault=function(){this.Es=!0,this.setBarSpacing(this.K.barSpacing),this.setRightOffset(this.K.rightOffset)},t.prototype.fixLeftEdge=function(){return this.K.fixLeftEdge},t.prototype.setBaseIndex=function(t){this.Es=!0,this.ks=t,this.Us(),this.Rs()},t.prototype.zoom=function(t,i){var n=this.js(t),s=this.barSpacing(),h=s+i*(s/10);this.setBarSpacing(h),this.K.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(n-this.js(t)))},t.prototype.startScale=function(t){this.pn&&this.endScroll(),null===this.Mn&&null===this.Bs&&(this.isEmpty()||(this.Mn=t,this._s()))},t.prototype.scaleTo=function(t){if(null!==this.Bs){var i=it(this._t-t,0,this._t),n=it(this._t-f(this.Mn),0,this._t);0!==i&&0!==n&&this.setBarSpacing(this.Bs.barSpacing*i/n)}},t.prototype.endScale=function(){null!==this.Mn&&(this.Mn=null,this.Ys())},t.prototype.startScroll=function(t){null===this.pn&&null===this.Bs&&(this.isEmpty()||(this.pn=t,this._s()))},t.prototype.scrollTo=function(t){if(this.Es=!0,null!==this.pn){var i=(this.pn-t)/this.barSpacing();this.Vs=f(this.Bs).rightOffset+i,this.Es=!0,this.Us()}},t.prototype.endScroll=function(){null!==this.pn&&(this.pn=null,this.Ys())},t.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this.K.rightOffset)},t.prototype.scrollToOffsetAnimated=function(t,i){var n=this;if(void 0===i&&(i=400),!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");var s=this.Vs,h=(new Date).getTime(),r=function(){var u=((new Date).getTime()-h)/i,e=u>=1,o=e?t:s+(t-s)*u;n.setRightOffset(o),e||setTimeout(r,20)};r()},t.prototype.update=function(t,i,n){if(this.Es=!0,i.length>0){var s=this.Ns.size();this.Ns.merge(t,i),this.Vs<0&&this.Ns.size()===s+1&&(this.Vs-=1,this.Es=!0)}this.xs.merge(n),this.Us()},t.prototype.visibleBarsChanged=function(){return this.Ts},t.prototype.optionsApplied=function(){return this.As},t.prototype.baseIndex=function(){return this.ks||0},t.prototype.setVisibleRange=function(t){var i=t.count();this.qs(this._t/i),this.Vs=t.lastBar()-this.baseIndex(),this.Us(),this.Es=!0,this.V.recalculateAllPanes(),this.V.lightUpdate()},t.prototype.fitContent=function(){var t=this.Ns.firstIndex(),i=this.Ns.lastIndex();null!==t&&null!==i&&this.setVisibleRange(new Ki(t-1,i+1+this.K.rightOffset))},t.prototype.setTimePointsRange=function(t){var i=this.points(),n=i.firstIndex(),s=i.lastIndex();if(null!==n&&null!==s){var h=f(i.valueAt(n)).timestamp,r=f(i.valueAt(s)).timestamp,u=new Ki(f(i.indexOf(Math.max(h,t.from.timestamp),!0)),f(i.indexOf(Math.min(r,t.to.timestamp),!0)));this.setVisibleRange(u)}},t.prototype.formatDateTime=function(t){return void 0!==this.kn.timeFormatter?this.kn.timeFormatter(t.businessDay||t.timestamp):this.Ks.format(new Date(1e3*t.timestamp))},t.prototype.$s=function(t){return(this._t+1-t)/this.Os},t.prototype.js=function(t){var i=this.$s(t),n=this.baseIndex()+this.Vs-i;return Math.round(1e6*n)/1e6},t.prototype.qs=function(t){t=nn(t);var i=this.Os;i!==t&&(this.Es=!0,this.Os=t,this.Ss.fire(i,t),this.Xs())},t.prototype.Ws=function(){if(this.isEmpty())this.Zs(null);else{var t=this.baseIndex(),i=Math.ceil(this._t/this.Os)-1,n=Math.round(this.Vs+t),s=n-i;this.Zs(new Ki(s,n))}},t.prototype.Us=function(){var t=this.Js();this.Vs>t&&(this.Vs=t,this.Es=!0);var i=this.Gs();null!==i&&this.Vs<i&&(this.Vs=i,this.Es=!0)},t.prototype.Gs=function(){var t=this.Ns.firstIndex(),i=this.ks;if(null===t||null===i)return null;if(null!==this.Ls){var n=this._t/this.Os;return this.Ls-i+n-1}return t-i-1+5},t.prototype.Js=function(){return this._t/this.Os-5},t.prototype._s=function(){this.Bs={barSpacing:this.barSpacing(),rightOffset:this.rightOffset()}},t.prototype.Ys=function(){this.Bs=null},t.prototype.Hs=function(t,i){var n=this,s=this.Cs.get(i);return void 0===s&&(s=new $i((function(t){return n.Qs(t,i)})),this.Cs.set(i,s)),void 0===t.businessDay?s.format(new Date(1e3*t.timestamp)):s.format(new Date(Date.UTC(t.businessDay.year,t.businessDay.month-1,t.businessDay.day)))},t.prototype.Qs=function(t,i){var n={},s=this.K.timeVisible;return i<20&&s?(n.hour12=!1,n.hour="2-digit",n.minute="2-digit",this.K.secondsVisible&&(n.second="2-digit")):i<40&&s?(n.hour12=!1,n.hour="2-digit",n.minute="2-digit"):i<50?n.day="numeric":i<60?n.day="numeric":i<70?n.month="short":n.year="numeric",new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()).toLocaleString(this.kn.locale,n)},t.prototype.Zs=function(t){if(null!==t||null!==this.Ds){var i=this.Ds;this.Ds=t,(null===this.Ds||null!==i&&!this.Ds.equals(i))&&this.Ts.fire(),this.Xs()}},t.prototype.Xs=function(){this.zs=null},t.prototype.Ps=function(){this.Xs(),this.Cs.clear()},t.prototype.Is=function(){var t=this.kn.dateFormat;this.K.timeVisible?this.Ks=new _i({dateFormat:t,timeFormat:this.K.secondsVisible?"%h:%m:%s":"%h:%m",dateTimeSeparator:"   ",locale:this.kn.locale}):this.Ks=new ji(t,this.kn.locale)},t.prototype.Rs=function(){if(this.K.fixLeftEdge){var t=this.Ns.firstIndex();if(null!==t&&this.Ls!==t){this.Ls=t;var i=f(this.visibleBars()).firstBar()-t;if(i<0){var n=this.Vs-i-1;this.setRightOffset(n)}}}},t}();function nn(t){return t<.5?.5:t>50?50:t}var sn=function(){function t(t){this.th=new Map,this.M=t}return t.prototype.draw=function(t){},t.prototype.drawBackground=function(t){if(this.M.visible){t.save();for(var i=0,n=0,s=this.M.lines;n<s.length;n++){if(0!==(o=s[n]).text.length){t.font=o.font;var h=this.ih(t,o.text);h>this.M.width?o.zoom=this.M.width/h:o.zoom=1,i+=o.lineHeight*o.zoom}}var r=0;switch(this.M.vertAlign){case"top":r=0;break;case"center":r=Math.max((this.M.height-i)/2,0);break;case"bottom":r=Math.max(this.M.height-i,0)}t.fillStyle=this.M.color;for(var u=0,e=this.M.lines;u<e.length;u++){var o=e[u];t.save();var f=0;switch(this.M.horzAlign){case"left":t.textAlign="left",f=o.lineHeight/2;break;case"center":t.textAlign="center",f=this.M.width/2;break;case"right":t.textAlign="right",f=this.M.width-1-o.lineHeight/2}t.translate(f,r),t.textBaseline="top",t.font=o.font,t.scale(o.zoom,o.zoom),t.fillText(o.text,0,o.vertOffset),t.restore(),r+=o.lineHeight*o.zoom}t.restore()}},t.prototype.ih=function(t,i){var n=this.nh(t.font),s=n.get(i);return void 0===s&&(s=t.measureText(i).width,n.set(i,s)),s},t.prototype.nh=function(t){var i=this.th.get(t);return void 0===i&&(i=new Map,this.th.set(t,i)),i},t}(),hn=function(){function t(t){this.o=!0,this.p={visible:!1,color:"",height:0,width:0,lines:[],vertAlign:"center",horzAlign:"center"},this.g=new sn(this.p),this.k=t}return t.prototype.update=function(){this.o=!0},t.prototype.renderer=function(t,i){return this.o&&(this.m(t,i),this.o=!1),this.g},t.prototype.m=function(t,i){var n=this.k.options(),s=this.p;s.visible=n.visible,s.visible&&(s.color=n.color,s.width=i,s.height=t,s.horzAlign=n.horzAlign,s.vertAlign=n.vertAlign,s.lines=[{text:n.text,font:Di(n.fontSize),lineHeight:1.2*n.fontSize,vertOffset:0,zoom:0}])},t}(),rn=function(t){function i(i,n){var s=t.call(this)||this;return s.K=n,s.J=new hn(s),s}return r(i,t),i.prototype.paneViews=function(){return[this.J]},i.prototype.options=function(){return this.K},i.prototype.updateAllViews=function(){this.J.update()},i}(H),un=function(){function t(t,i){this.sh=[],this.hh=[],this._t=0,this.rh=null,this.uh=null,this.eh=new G,this.oh=new G,this.fh=t,this.K=i,this.ah=new Ti(this),this.Kn=new tn(this,i.timeScale,this.K.localization),this.lh=new Bi,this.v=new Y(this,i.crosshair),this.vh=new Fi(i.crosshair),this.dh=new rn(this,i.watermark),this.createPane(),this.sh[0].setStretchFactor(2*Vi),this.sh[0].addDataSource(this.dh,!0,!1)}return t.prototype.fullUpdate=function(){this.wh(new zi(3))},t.prototype.lightUpdate=function(){this.wh(new zi(2))},t.prototype.updateSource=function(t){var i=this.bh(t);this.wh(i)},t.prototype.hoveredSource=function(){return this.uh},t.prototype.setHoveredSource=function(t){var i=this.uh;this.uh=t,null!==i&&this.updateSource(i.source),null!==t&&this.updateSource(t.source)},t.prototype.options=function(){return this.K},t.prototype.applyOptions=function(t){c(this.K,t),void 0!==t.priceScale&&(this.mainPriceScale().applyOptions(t.priceScale),this.eh.fire()),void 0!==t.timeScale&&this.Kn.applyOptions(t.timeScale),void 0!==t.localization&&(this.Kn.applyLocalizationOptions(t.localization),this.mainPriceScale().updateFormatter()),this.fullUpdate()},t.prototype.updateAllPaneViews=function(){this.sh.forEach((function(t){return t.updateAllViews()})),this.updateCrosshair()},t.prototype.timeScale=function(){return this.Kn},t.prototype.panes=function(){return this.sh},t.prototype.gridSource=function(){return this.lh},t.prototype.watermarkSource=function(){return this.dh},t.prototype.crosshairSource=function(){return this.v},t.prototype.crosshairMoved=function(){return this.oh},t.prototype.width=function(){return this._t},t.prototype.setPaneHeight=function(t,i){t.setHeight(i),this.recalculateAllPanes(),this.lightUpdate()},t.prototype.setWidth=function(t){this._t=t,this.Kn.setWidth(this._t),this.sh.forEach((function(i){return i.setWidth(t)})),this.recalculateAllPanes()},t.prototype.createPane=function(t){var i=new Oi(this.Kn,this);void 0!==t?this.sh.splice(t,0,i):this.sh.push(i);var n=void 0===t?this.sh.length-1:t,s=new zi(3);return s.invalidatePane(n,{level:0,autoScale:!0}),this.invalidate(s),i},t.prototype.startScalePrice=function(t,i,n){t.startScalePrice(i,n)},t.prototype.scalePriceTo=function(t,i,n){t.scalePriceTo(i,n),this.updateCrosshair(),this.wh(this.mh(t,2))},t.prototype.endScalePrice=function(t,i){t.endScalePrice(i),this.wh(this.mh(t,2))},t.prototype.startScrollPrice=function(t,i,n){i.isAutoScale()||t.startScrollPrice(i,n)},t.prototype.scrollPriceTo=function(t,i,n){i.isAutoScale()||(t.scrollPriceTo(i,n),this.updateCrosshair(),this.wh(this.mh(t,2)))},t.prototype.endScrollPrice=function(t,i){i.isAutoScale()||(t.endScrollPrice(i),this.wh(this.mh(t,2)))},t.prototype.setPriceAutoScale=function(t,i,n){t.setPriceAutoScale(i,n),this.wh(this.mh(t,2))},t.prototype.resetPriceScale=function(t,i){t.resetPriceScale(i),this.wh(this.mh(t,2))},t.prototype.startScaleTime=function(t){this.Kn.startScale(t)},t.prototype.zoomTime=function(t,i){var n=this.timeScale();if(!n.isEmpty()&&0!==i){var s=n.width();t=Math.max(1,Math.min(t,s)),n.zoom(t,i),this.updateCrosshair(),this.recalculateAllPanes(),this.lightUpdate()}},t.prototype.scrollChart=function(t){this.startScrollTime(0),this.scrollTimeTo(t),this.endScrollTime()},t.prototype.scaleTimeTo=function(t){this.Kn.scaleTo(t),this.recalculateAllPanes(),this.updateCrosshair(),this.lightUpdate()},t.prototype.endScaleTime=function(){this.Kn.endScale(),this.lightUpdate()},t.prototype.startScrollTime=function(t){this.rh=t,this.Kn.startScroll(t)},t.prototype.scrollTimeTo=function(t){var i=!1;return null!==this.rh&&Math.abs(t-this.rh)>20&&(this.rh=null,i=!0),this.Kn.scrollTo(t),this.recalculateAllPanes(),this.updateCrosshair(),this.lightUpdate(),i},t.prototype.endScrollTime=function(){this.Kn.endScroll(),this.lightUpdate(),this.rh=null},t.prototype.resetTimeScale=function(){this.Kn.restoreDefault(),this.recalculateAllPanes(),this.updateCrosshair(),this.lightUpdate()},t.prototype.invalidate=function(t){this.fh&&this.fh(t),this.lh.invalidate(),this.lightUpdate()},t.prototype.dataSources=function(){return this.sh.reduce((function(t,i){return t.concat(i.dataSources())}),[])},t.prototype.serieses=function(){return this.hh},t.prototype.setAndSaveCurrentPosition=function(t,i,n){this.v.saveOriginCoord(t,i);var s=NaN,h=this.Kn.coordinateToIndex(t),r=this.Kn.visibleBars();if(null!==r&&(h=Math.min(Math.max(r.firstBar(),h),r.lastBar())),null!==n.mainDataSource()){var u=n.defaultPriceScale(),e=u.firstValue();null!==e&&(s=u.coordinateToPrice(i,e)),s=this.vh.align(s,h,n)}this.v.setPosition(h,s,n),this.Mh(),this.oh.fire(this.v.appliedIndex(),{x:t,y:i})},t.prototype.clearCurrentPosition=function(){this.crosshairSource().clearPosition(),this.Mh(),this.oh.fire(null,null)},t.prototype.updateCrosshair=function(){var t=this.v.pane();if(null!==t){var i=this.v.originCoordX(),n=this.v.originCoordY();this.setAndSaveCurrentPosition(i,n,t)}},t.prototype.updateTimeScale=function(t,i,n,s){s&&this.Kn.reset(),this.Kn.update(t,i,n)},t.prototype.updateTimeScaleBaseIndex=function(t){var i=this.hh.reduce((function(t,i){var n=i.bars();if(n.isEmpty())return t;var s=f(n.lastIndex());return void 0===t?s:Math.max(s,t)}),void 0);if(void 0!==i){var n=this.Kn,s=n.baseIndex(),h=n.visibleBars();if(null!==h){var r=h.contains(s);if(void 0!==t&&t>0&&!r){var u=i-s;n.setRightOffset(n.rightOffset()-u)}}n.setBaseIndex(i)}this.updateCrosshair(),this.recalculateAllPanes(),this.lightUpdate()},t.prototype.recalculatePane=function(t){null!==t&&t.recalculate()},t.prototype.paneForSource=function(t){var i=this.sh.find((function(i){return i.orderedSources().includes(t)}));return void 0===i?null:i},t.prototype.recalculateAllPanes=function(){this.sh.forEach((function(t){return t.recalculate()})),this.updateAllPaneViews()},t.prototype.destroy=function(){this.sh.forEach((function(t){return t.destroy()})),this.sh.length=0,this.K.localization.priceFormatter=void 0,this.K.localization.timeFormatter=void 0},t.prototype.setPriceAutoScaleForAllMainSources=function(){this.sh.map((function(t){return t.mainDataSource()})).forEach((function(t){null!==t&&f(t.priceScale()).setMode({autoScale:!0})}))},t.prototype.rendererOptionsProvider=function(){return this.ah},t.prototype.priceAxisRendererOptions=function(){return this.ah.options()},t.prototype.mainPriceScaleOptionsChanged=function(){return this.eh},t.prototype.mainPriceScale=function(){return this.sh[0].defaultPriceScale()},t.prototype.createSeries=function(t,i){var n=this.sh[0],s=this.ph(i,t,n);return this.hh.push(s),1===this.hh.length?this.fullUpdate():this.lightUpdate(),s},t.prototype.removeSeries=function(t){var i=this.paneForSource(t),n=this.hh.indexOf(t);e(-1!==n,"Series not found"),this.hh.splice(n,1),f(i).removeDataSource(t),t.destroy&&t.destroy()},t.prototype.fitContent=function(){var t=new zi(2);t.setFitContent(),this.wh(t)},t.prototype.setTargetTimeRange=function(t){var i=new zi(2);i.setTargetTimeRange(t),this.wh(i)},t.prototype.mh=function(t,i){var n=new zi(i);if(null!==t){var s=this.sh.indexOf(t);n.invalidatePane(s,{level:i})}return n},t.prototype.bh=function(t,i){return void 0===i&&(i=2),this.mh(this.paneForSource(t),i)},t.prototype.wh=function(t){this.fh&&this.fh(t),this.lh.invalidate()},t.prototype.Mh=function(){this.wh(new zi(1))},t.prototype.ph=function(t,i,n){var s=new Mi(this,t,i);return n.addDataSource(s,Boolean(t.overlay),!1),t.overlay&&s.applyOptions(t),s},t}();var en=function(){function t(t){var i=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(t){return i._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=t,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._configureCanvas(),this._installResolutionListener()}return t.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(t.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),t.prototype.resizeCanvas=function(t){this._canvasSize={width:t.width,height:t.height},this._configureCanvas()},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");return t.devicePixelRatio},enumerable:!0,configurable:!0}),t.prototype.subscribeCanvasConfigured=function(t){this._canvasConfiguredListeners.push(t)},t.prototype.unsubscribeCanvasConfigured=function(t){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter((function(i){return i!=t}))},t.prototype._configureCanvas=function(){var t=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*t,this.canvas.height=this._canvasSize.height*t,this._emitCanvasConfigured()},t.prototype._emitCanvasConfigured=function(){var t=this;this._canvasConfiguredListeners.forEach((function(i){return i.call(t)}))},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this.canvas.ownerDocument.defaultView;if(null==t)throw new Error("No window is associated with the canvas");var i=t.devicePixelRatio;this._resolutionMediaQueryList=t.matchMedia("all and (resolution: "+i+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},t}(),on=function(){function t(t,i){this.w=t,this.h=i}return t.prototype.equals=function(t){return this.w===t.w&&this.h===t.h},t}();function fn(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||1}function an(t){var i=f(t.getContext("2d")),n=fn(t);return i.setTransform(n,0,0,n,0,0),i}function cn(t){var i=f(t.canvas.getContext("2d"));return i.setTransform(t.pixelRatio,0,0,t.pixelRatio,0,0),i.translate(.5,.5),i}function ln(t,i,n,s,h,r){t.save(),t.translate(-.5,-.5),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,n,s,h),t.restore()}function vn(t){var i=t.createElement("canvas");return function(t){t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.MozUserSelect="none",t.style.webkitTapHighlightColor="transparent"}(i),i}function dn(t,i){var n=vn(t),s=fn(n);return n.style.width=i.w+"px",n.style.height=i.h+"px",n.width=i.w*s,n.height=i.h*s,n}function wn(t,i){var n=vn(f(t.ownerDocument));t.appendChild(n);var s=function(t){return new en(t)}(n);return s.resizeCanvas({width:i.w,height:i.h}),s}var bn,mn=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||Boolean(window.DocumentTouch&&document instanceof window.DocumentTouch),Mn="onorientationchange"in window&&mn,pn=/Android/i.test(navigator.userAgent),gn=/iPhone|iPad|iPod|AppleWebKit.+Mobile/i.test(navigator.userAgent),yn=pn||gn;!function(t){t[t.ResetClick=500]="ResetClick",t[t.LongTap=240]="LongTap"}(bn||(bn={}));var kn=function(){function t(t,i,n){this.gh=0,this.yh=null,this.kh=null,this.Nh=!1,this.Sh=null,this.xh=!1,this.Ch=!1,this.Dh=null,this.Eh=null,this.Th=null,this.Ah=null,this.Lh=0,this.Bh=!1,this.zh=!1,this.Fh=!1,this.Vh=t,this.Oh=i,this.K=n,this.Ih()}return t.prototype.destroy=function(){null!==this.Dh&&(this.Dh(),this.Dh=null),null!==this.Eh&&(this.Eh(),this.Eh=null),null!==this.Th&&(this.Th(),this.Th=null),this.Ph(),this.Rh()},t.prototype.Wh=function(t){var i=this;this.Eh&&this.Eh();var n=this.qh.bind(this);this.Eh=function(){i.Vh.removeEventListener("mousemove",n)},this.Vh.addEventListener("mousemove",n),xn(t)&&this.qh(t);var s=this.Uh(t);this.jh(s,this.Oh.mouseEnterEvent)},t.prototype.Rh=function(){null!==this.yh&&clearTimeout(this.yh),this.gh=0,this.yh=null},t.prototype.qh=function(t){if(!this.Fh||xn(t)){var i=this.Uh(t);this.jh(i,this.Oh.mouseMoveEvent)}},t.prototype.Hh=function(t){if(!("button"in t&&0!==t.button)&&null===this.Ah){var i=xn(t);if(!this.zh||!i){this.Bh=!0;var n=this.Uh(t),s=a(this.Sh),h=Math.abs(s.x-n.pageX),r=Math.abs(s.y-n.pageY),u=h+r>5;if(u||!i){if(u&&!this.xh&&i){var e=.5*h,o=r>=e&&!this.K.treatVertTouchDragAsPageScroll,f=e>r&&!this.K.treatHorzTouchDragAsPageScroll;o||f||(this.zh=!0)}u&&(this.xh=!0,this.Ch=!0,i&&this.Ph()),this.zh||(this.jh(n,this.Oh.pressedMouseMoveEvent),i&&Cn(t))}}}},t.prototype.Yh=function(t){if(!("button"in t&&0!==t.button)){var i=this.Uh(t);this.Ph(),this.Sh=null,this.Fh=!1,this.Th&&(this.Th(),this.Th=null),xn(t)&&this._h(t),this.jh(i,this.Oh.mouseUpEvent),++this.gh,this.yh&&this.gh>1?(this.jh(i,this.Oh.mouseDoubleClickEvent),this.Rh()):this.Ch||this.jh(i,this.Oh.mouseClickEvent),xn(t)&&(Cn(t),this._h(t),0===t.touches.length&&(this.Nh=!1))}},t.prototype.Ph=function(){null!==this.kh&&(clearTimeout(this.kh),this.kh=null)},t.prototype.Kh=function(t){if(!("button"in t&&0!==t.button)){var i=this.Uh(t);this.Ch=!1,this.xh=!1,this.zh=!1,xn(t)&&this.Wh(t),this.Sh={x:i.pageX,y:i.pageY},this.Th&&(this.Th(),this.Th=null);var n=this.Hh.bind(this),s=this.Yh.bind(this),h=this.Vh.ownerDocument.documentElement;this.Th=function(){h.removeEventListener("touchmove",n),h.removeEventListener("touchend",s),h.removeEventListener("mousemove",n),h.removeEventListener("mouseup",s)},h.addEventListener("touchmove",n,{passive:!1}),h.addEventListener("touchend",s,{passive:!1}),this.Ph(),xn(t)&&1===t.touches.length?this.kh=setTimeout(this.$h.bind(this,t),240):(h.addEventListener("mousemove",n),h.addEventListener("mouseup",s)),this.Fh=!0,this.jh(i,this.Oh.mouseDownEvent),this.yh||(this.gh=0,this.yh=setTimeout(this.Rh.bind(this),500))}},t.prototype.Ih=function(){var t=this;this.Vh.addEventListener("mouseenter",this.Wh.bind(this)),this.Vh.addEventListener("touchcancel",this.Ph.bind(this));var i=this.Vh.ownerDocument,n=function(i){t.Oh.mouseDownOutsideEvent&&(i.target&&t.Vh.contains(i.target)||t.Oh.mouseDownOutsideEvent())};this.Dh=function(){i.removeEventListener("mousedown",n),i.removeEventListener("touchstart",n)},i.addEventListener("mousedown",n),i.addEventListener("touchstart",n,{passive:!0}),this.Vh.addEventListener("mouseleave",this._h.bind(this)),this.Vh.addEventListener("touchstart",this.Kh.bind(this),{passive:!0}),Mn||this.Vh.addEventListener("mousedown",this.Kh.bind(this)),this.Xh(),this.Vh.addEventListener("touchmove",(function(){}),{passive:!1})},t.prototype.Xh=function(){var t=this;void 0===this.Oh.pinchStartEvent&&void 0===this.Oh.pinchEvent&&void 0===this.Oh.pinchEndEvent||(this.Vh.addEventListener("touchstart",(function(i){return t.Zh(i.touches)}),{passive:!0}),this.Vh.addEventListener("touchmove",(function(i){if(2===i.touches.length&&null!==t.Ah&&void 0!==t.Oh.pinchEvent){var n=Sn(i.touches[0],i.touches[1])/t.Lh;t.Oh.pinchEvent(t.Ah,n),Cn(i)}}),{passive:!1}),this.Vh.addEventListener("touchend",(function(i){t.Zh(i.touches)})))},t.prototype.Zh=function(t){1===t.length&&(this.Bh=!1),2!==t.length||this.Bh||this.Nh?this.Jh():this.Gh(t)},t.prototype.Gh=function(t){var i=Nn(this.Vh);this.Ah={x:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,y:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Lh=Sn(t[0],t[1]),void 0!==this.Oh.pinchStartEvent&&this.Oh.pinchStartEvent(),this.Ph()},t.prototype.Jh=function(){null!==this.Ah&&(this.Ah=null,void 0!==this.Oh.pinchEndEvent&&this.Oh.pinchEndEvent())},t.prototype._h=function(t){this.Eh&&this.Eh();var i=this.Uh(t);this.jh(i,this.Oh.mouseLeaveEvent)},t.prototype.$h=function(t){var i=this.Uh(t);this.jh(i,this.Oh.longTapEvent),this.Ch=!0,this.Nh=!0},t.prototype.jh=function(t,i){i&&i.call(this.Oh,t)},t.prototype.Uh=function(t){var i;i="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var n=Nn(this.Vh);return{clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,localX:i.clientX-n.left,localY:i.clientY-n.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?"mouse":"touch",target:i.target,view:t.view}},t}();function Nn(t){return t.getBoundingClientRect()||{left:0,top:0}}function Sn(t,i){var n=t.clientX-i.clientX,s=t.clientY-i.clientY;return Math.sqrt(n*n+s*s)}function xn(t){return Boolean(t.touches)}function Cn(t){t.cancelable&&t.preventDefault()}var Dn,En=1,Tn=function(){function t(t,i,n,s){if(this.Qh=0,this.tr=0,this.ir=0,this.nr=0,this.sr=0,this.hr=0,this.rr=0,this.ur=t,this.er=t.paneWidgets()[i],this.or=t.paneWidgets()[n],this.ar=document.createElement("tr"),this.ar.style.height=En+"px",this.cr=document.createElement("td"),this.cr.style.padding="0",this.cr.setAttribute("colspan","3"),this.lr(),this.ar.appendChild(this.cr),s)this.vr=null,this.dr=null;else{this.vr=document.createElement("div"),this.vr.style.position="absolute",this.vr.style.zIndex="50",this.vr.style.height="5px",this.vr.style.width="100%",this.vr.style.backgroundColor="rgba(255, 255, 255, 0.02)",this.vr.style.cursor="ns-resize",this.cr.appendChild(this.vr);var h={mouseDownEvent:this.wr.bind(this),pressedMouseMoveEvent:this.br.bind(this),mouseUpEvent:this.mr.bind(this)};this.dr=new kn(this.vr,h,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})}}return t.prototype.destroy=function(){null!==this.dr&&this.dr.destroy()},t.prototype.getElement=function(){return this.ar},t.prototype.getSize=function(){return new on(this.er.getSize().w,En)},t.prototype.getImage=function(){var t=this.getSize(),i=dn(document,t),n=an(i);return n.fillStyle=this.ur.options().timeScale.borderColor,n.fillRect(0,0,t.w,t.h),i},t.prototype.update=function(){this.lr()},t.prototype.lr=function(){this.cr.style.background=this.ur.options().timeScale.borderColor},t.prototype.wr=function(t){this.Qh=t.pageY,this.tr=0,this.ir=this.er.getSize().h+this.or.getSize().h,this.nr=this.er.stretchFactor()+this.or.stretchFactor(),this.sr=30,this.hr=this.ir-this.sr,this.rr=this.nr/this.ir},t.prototype.br=function(t){this.tr=t.pageY-this.Qh;var i=this.er.getSize().h,n=it(i+this.tr,this.sr,this.hr)*this.rr,s=this.nr-n;this.er.setStretchFactor(n),this.or.setStretchFactor(s),this.ur.adjustSize(),this.er.getSize().h!==i&&(this.Qh=t.pageY)},t.prototype.mr=function(t){this.Qh=0,this.tr=0,this.ir=0,this.nr=0,this.sr=0,this.hr=0,this.rr=0},t}(),An=200,Ln=function(){function t(t,i,n,s){this.Kt=new It(An),this.Zt=0,this.Mr="",this.pr="",this.gr=[],this.yr=new Map,this.Zt=t,this.Mr=i,this.pr=Di(t,n,s)}return t.prototype.destroy=function(){delete this.Kt,this.gr=[],this.yr.clear()},t.prototype.paintTo=function(t,i,n,s,h){var r=this.getLabelImage(t,i);"left"!==h&&(n-=r.textWidth),s-=Math.floor(r.height/2),t.drawImage(r.canvas,n,s,r.width,r.height)},t.prototype.getLabelImage=function(t,i){var n;if(this.yr.has(i))n=o(this.yr.get(i));else{if(this.gr.length>=An){var s=o(this.gr.shift());this.yr.delete(s)}var h=Math.ceil(this.Zt/4.5),r=Math.round(this.Zt/10),u=Math.ceil(this.Kt.measureText(t,i)),e=Math.round(u+2*h),f=this.Zt+2*h,a=dn(document,new on(e,f));n={text:i,textWidth:Math.round(Math.max(1,u)),width:e,height:f,canvas:a},0!==u&&(this.gr.push(n.text),this.yr.set(n.text,n)),(t=an(n.canvas)).font=this.pr,t.fillStyle=this.Mr,t.fillText(i,0,n.height-h-r)}return n},t}();!function(t){t[t.Default=0]="Default",t[t.NsResize=1]="NsResize"}(Dn||(Dn={}));var Bn,zn,Fn=function(){function t(t,i,n,s){var h=this;this.B=null,this.kr=null,this.Nr=null,this.Sr=!1,this.xr=!0,this.Cr=new It(50),this.Dr=new Ln(11,"#000"),this.Mr=null,this.pr=null,this.Er=0,this.Tr=function(){h.Ar(h.ah.options()),h.I.chart().model().lightUpdate()},this.Lr=function(){h.I.chart().model().lightUpdate()},this.I=t,this.K=i,this.ah=n,this.Br="left"===s,this.cr=document.createElement("div"),this.cr.style.height="100%",this.cr.style.overflow="hidden",this.cr.style.width="25px",this.cr.style.left="0",this.cr.style.position="relative",this.zr=wn(this.cr,new on(16,16)),this.zr.subscribeCanvasConfigured(this.Tr);var r=this.zr.canvas;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.Fr=wn(this.cr,new on(16,16)),this.Fr.subscribeCanvasConfigured(this.Lr);var u=this.Fr.canvas;u.style.position="absolute",u.style.zIndex="2",u.style.left="0",u.style.top="0";var e={mouseDownEvent:this.wr.bind(this),pressedMouseMoveEvent:this.br.bind(this),mouseDownOutsideEvent:this.Vr.bind(this),mouseUpEvent:this.mr.bind(this),mouseDoubleClickEvent:this.Or.bind(this),mouseEnterEvent:this.Ir.bind(this),mouseLeaveEvent:this.Pr.bind(this)};this.dr=new kn(this.Fr.canvas,e,{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})}return t.prototype.destroy=function(){this.dr.destroy(),this.Fr.unsubscribeCanvasConfigured(this.Lr),this.Fr.destroy(),this.zr.unsubscribeCanvasConfigured(this.Tr),this.zr.destroy(),null!==this.B&&(this.B.onMarksChanged().unsubscribeAll(this),this.B.optionsChanged().unsubscribeAll(this)),this.B=null,null!==this.Nr&&(clearTimeout(this.Nr),this.Nr=null),this.Dr.destroy()},t.prototype.getElement=function(){return this.cr},t.prototype.backgroundColor=function(){return this.K.backgroundColor},t.prototype.lineColor=function(){return this.I.chart().options().priceScale.borderColor},t.prototype.textColor=function(){return this.K.textColor},t.prototype.fontSize=function(){return this.K.fontSize},t.prototype.baseFont=function(){return Di(this.fontSize(),this.K.fontFamily)},t.prototype.rendererOptions=function(){var t=this.ah.options(),i=this.Mr!==t.color,n=this.pr!==t.font;return(i||n)&&(this.Ar(t),this.Mr=t.color),n&&(this.Cr.reset(),this.pr=t.font),t},t.prototype.optimalWidth=function(){if(!this.isVisible()||null===this.B)return 0;var t=34,i=this.rendererOptions(),n=cn(this.zr),s=this.B.marks();n.font=this.baseFont(),s.length>0&&(t=Math.max(this.Cr.measureText(n,s[0].label),this.Cr.measureText(n,s[s.length-1].label)));for(var h=this.Rr(),r=h.length;r--;){var u=this.Cr.measureText(n,h[r].text());u>t&&(t=u)}return Math.ceil(i.offsetSize+i.borderSize+i.tickLength+i.paddingInner+i.paddingOuter+t)},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(t));null!==this.kr&&this.kr.equals(t)||(this.kr=t,this.zr.resizeCanvas({width:t.w,height:t.h}),this.Fr.resizeCanvas({width:t.w,height:t.h}),this.cr.style.width=t.w+"px",this.cr.style.height=t.h+"px",this.cr.style.minWidth=t.w+"px")},t.prototype.getWidth=function(){return f(this.kr).w},t.prototype.setPriceScale=function(t){this.B!==t&&(null!==this.B&&(this.B.onMarksChanged().unsubscribeAll(this),this.B.optionsChanged().unsubscribeAll(this)),this.B=t,t.onMarksChanged().subscribe(this.cn.bind(this),this))},t.prototype.priceScale=function(){return this.B},t.prototype.isVisible=function(){return this.xr},t.prototype.setVisible=function(t){t!==this.xr&&(this.cr.style.display=t?"table-cell":"none",this.xr=t)},t.prototype.setAutoScale=function(t){var i=this.I.state();this.I.chart().model().setPriceAutoScale(i,f(this.priceScale()),t)},t.prototype.reset=function(){var t=this.I.state();this.I.chart().model().resetPriceScale(t,f(this.priceScale()))},t.prototype.paint=function(t){if(this.xr&&null!==this.kr){if(1!==t){var i=cn(this.zr);this.Wr(),this.qr(i),this.Lt(i),this.Ur(i),this.jr(i)}var n=cn(this.Fr);n.clearRect(-.5,-.5,this.kr.w,this.kr.h),this.Hr(n)}},t.prototype.getImage=function(){return this.zr.canvas},t.prototype.isLeft=function(){return this.Br},t.prototype.wr=function(t){if(null!==this.B&&!this.B.isEmpty()&&this.I.chart().options().handleScale.axisPressedMouseMove){var i=this.I.chart().model(),n=this.I.state();this.Sr=!0,i.startScalePrice(n,this.B,t.localY)}},t.prototype.br=function(t){if(null!==this.B&&this.I.chart().options().handleScale.axisPressedMouseMove){var i=this.I.chart().model(),n=this.I.state(),s=this.B;i.scalePriceTo(n,s,t.localY)}},t.prototype.Vr=function(){if(null!==this.B&&this.I.chart().options().handleScale.axisPressedMouseMove){var t=this.I.chart().model(),i=this.I.state(),n=this.B;this.Sr&&(this.Sr=!1,t.endScalePrice(i,n))}},t.prototype.mr=function(t){if(null!==this.B&&this.I.chart().options().handleScale.axisPressedMouseMove){var i=this.I.chart().model(),n=this.I.state();this.Sr=!1,i.endScalePrice(n,this.B)}},t.prototype.Or=function(t){this.I.chart().options().handleScale.axisDoubleClickReset&&this.reset()},t.prototype.Ir=function(t){null!==this.B&&(!this.I.chart().model().options().handleScale.axisPressedMouseMove||this.B.isPercentage()||this.B.isIndexedTo100()||this.Yr(1))},t.prototype.Pr=function(t){this.Yr(0)},t.prototype.Rr=function(){var t=this,i=[],n=null===this.B?void 0:this.B;return function(s){for(var h=0;h<s.length;++h)for(var r=s[h].priceAxisViews(t.I.state(),n),u=0;u<r.length;u++)i.push(r[u])}(this.I.state().orderedSources()),i},t.prototype.qr=function(t){null!==this.kr&&ln(t,0,0,this.kr.w,this.kr.h,this.backgroundColor())},t.prototype.Lt=function(t){if(null!==this.kr&&null!==this.B&&this.B.options().borderVisible){t.save(),t.fillStyle=this.lineColor();var i,n=this.rendererOptions().borderSize;this.Br?(t.translate(-.5,-.5),i=this.kr.w-n-1):(t.translate(.5,-.5),i=0),t.fillRect(i,0,n,this.kr.h),t.restore()}},t.prototype.Ur=function(t){if(null!==this.kr&&null!==this.B){t.save(),t.strokeStyle=this.lineColor();var i=this.B.marks();t.font=this.baseFont(),t.translate(-.5,-.5),t.fillStyle=this.lineColor();var n=this.rendererOptions(),s=this.B.options().borderVisible,h=this.Br?this.kr.w-n.offsetSize-n.borderSize-n.tickLength:n.borderSize+n.offsetSize,r=this.Br?h-n.paddingInner:h+n.tickLength+n.paddingInner,u=this.Br?"right":"left";if(s){t.beginPath();for(var e=0,o=i;e<o.length;e++){var f=o[e];t.rect(h,f.coord,n.tickLength,1)}t.fill()}t.fillStyle=this.textColor();for(var a=0,c=i;a<c.length;a++){f=c[a];this.Dr.paintTo(t,f.label,r,f.coord,u)}t.restore()}},t.prototype.Wr=function(){if(null!==this.kr&&null!==this.B){var t=this.kr.h/2,i=[],n=this.B.orderedSources().slice(),s=this.I.state(),h=this.rendererOptions();this.B===s.defaultPriceScale()&&this.I.state().orderedSources().forEach((function(t){s.isOverlay(t)&&n.push(t)}));var r=this.B.mainSource(),u=this.B;n.forEach((function(n){var h=n.priceAxisViews(s,u);h.forEach((function(t){t.setFixedCoordinate(null),t.isVisible()&&i.push(t)})),r===n&&h.length>0&&(t=h[0].floatCoordinate())}));var e=i.filter((function(i){return i.floatCoordinate()<=t})),o=i.filter((function(i){return i.floatCoordinate()>t}));if(e.sort((function(t,i){return i.floatCoordinate()-t.floatCoordinate()})),e.length&&o.length&&o.push(e[0]),o.sort((function(t,i){return t.floatCoordinate()-i.floatCoordinate()})),i.forEach((function(t){return t.setFixedCoordinate(t.coordinate())})),this.B.options().alignLabels){for(var f=1;f<e.length;f++){var a=e[f],c=(v=e[f-1]).height(h,!1);a.coordinate()>(d=v.getFixedCoordinate())-c&&a.setFixedCoordinate(d-c)}for(var l=1;l<o.length;l++){var v,d;a=o[l],c=(v=o[l-1]).height(h,!0);a.coordinate()<(d=v.getFixedCoordinate())+c&&a.setFixedCoordinate(d+c)}}}},t.prototype.jr=function(t){var i=this;if(null!==this.kr){var n=this.kr,s=this.Rr(),h=this.rendererOptions(),r=this.Br?"right":"left";s.forEach((function(s){if(s.isAxisLabelVisible()){var u=s.renderer();t.save(),u.draw(t,h,i.Cr,n.w,r),t.restore()}}))}},t.prototype.Hr=function(t){var i=this;if(null!==this.kr&&null!==this.B){var n=this.kr,s=this.I.chart().model(),h=[],r=this.I.state(),u=s.crosshairSource().priceAxisViews(r,this.B);u.length&&h.push(u);var e=this.rendererOptions(),o=this.Br?"right":"left";h.forEach((function(s){s.forEach((function(s){t.save(),s.renderer().draw(t,e,i.Cr,n.w,o),t.restore()}))}))}},t.prototype.Yr=function(t){this.cr.style.cursor=1===t?"ns-resize":"default"},t.prototype.cn=function(){var t=this,i=this.optimalWidth();if(this.Er<i){var n=this.I.chart();null===this.Nr&&(this.Nr=setTimeout((function(){n&&n.model().fullUpdate(),t.Nr=null}),100))}this.Er=i},t.prototype.Ar=function(t){this.Dr.destroy(),this.Dr=new Ln(t.fontSize,t.color,t.fontFamily)},t}(),Vn=yn,On=function(){function t(t,i){var n=this;this.kr=new on(0,0),this._r=null,this.Kr=null,this.$r=!1,this.Xr="none",this.Zr=new G,this.Jr=0,this.Gr=!1,this.Qr=null,this.tu=!1,this.iu=null,this.Tr=function(){return n.nu&&n.V().lightUpdate()},this.Lr=function(){return n.nu&&n.V().lightUpdate()},this.su=t,this.nu=i,this.nu.onDestroyed().subscribe(this.hu.bind(this),this,!0),this.ru=document.createElement("td"),this.ru.style.padding="0",this.ru.style.position="relative";var s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.uu=document.createElement("td"),this.uu.style.padding="0",this.eu=document.createElement("td"),this.eu.style.padding="0",this.ru.appendChild(s),this.zr=wn(s,new on(16,16)),this.zr.subscribeCanvasConfigured(this.Tr);var h=this.zr.canvas;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this.Fr=wn(s,new on(16,16)),this.Fr.subscribeCanvasConfigured(this.Lr);var r=this.Fr.canvas;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this.ar=document.createElement("tr"),this.ar.appendChild(this.uu),this.ar.appendChild(this.ru),this.ar.appendChild(this.eu),this.ou(),t.model().mainPriceScaleOptionsChanged().subscribe(this.fu.bind(this),this),this.updatePriceAxisWidget();var u=this.chart().options().handleScroll;this.dr=new kn(this.Fr.canvas,this,{treatVertTouchDragAsPageScroll:!u.vertTouchDrag,treatHorzTouchDragAsPageScroll:!u.horzTouchDrag})}return t.prototype.destroy=function(){null!==this._r&&this._r.destroy(),this.Fr.unsubscribeCanvasConfigured(this.Lr),this.Fr.destroy(),this.zr.unsubscribeCanvasConfigured(this.Tr),this.zr.destroy(),null!==this.nu&&this.nu.onDestroyed().unsubscribeAll(this),this.dr.destroy()},t.prototype.state=function(){return f(this.nu)},t.prototype.stateOrNull=function(){return this.nu},t.prototype.setState=function(i){null!==this.nu&&this.nu.onDestroyed().unsubscribeAll(this),this.nu=i,null!==this.nu&&this.nu.onDestroyed().subscribe(t.prototype.hu.bind(this),this,!0),this.updatePriceAxisWidget()},t.prototype.chart=function(){return this.su},t.prototype.getElement=function(){return this.ar},t.prototype.updatePriceAxisWidget=function(){if(null!==this.nu&&null!==this._r&&0!==this.V().serieses().length){var t=this.nu.defaultPriceScale();this._r.setPriceScale(f(t))}},t.prototype.stretchFactor=function(){return null!==this.nu?this.nu.stretchFactor():0},t.prototype.setStretchFactor=function(t){this.nu&&this.nu.setStretchFactor(t)},t.prototype.mouseEnterEvent=function(t){if(this.nu){var i=t.localX,n=t.localY;Mn||this.au(i,n)}},t.prototype.mouseDownEvent=function(t){if(this.Gr=!1,this.tu=null!==this.Qr,this.nu){if(document.activeElement!==document.body&&document.activeElement!==document.documentElement)f(document.activeElement).blur();else{var i=document.getSelection();null!==i&&i.removeAllRanges()}var n=this.V();if(!this.nu.defaultPriceScale().isEmpty()&&!n.timeScale().isEmpty()){if(null!==this.Qr){var s=n.crosshairSource();this.iu={x:s.appliedX(),y:s.appliedY()},this.Qr={x:t.localX,y:t.localY}}Mn||this.au(t.localX,t.localY)}}},t.prototype.mouseMoveEvent=function(t){if(this.nu){var i=t.localX,n=t.localY;if(this.cu()&&this.lu(),!Mn){this.au(i,n);var s=this.hitTest(i,n);this.V().setHoveredSource(s&&{source:s.source,object:s.object}),null!==s&&void 0!==s.view.moveHandler&&s.view.moveHandler(i,n)}}},t.prototype.mouseClickEvent=function(t){if(null!==this.nu){var i=t.localX,n=t.localY,s=this.hitTest(i,n);if(null!==s&&void 0!==s.view.clickHandler&&s.view.clickHandler(i,n),this.Zr.hasListeners()){var h=this.V().crosshairSource().appliedIndex();this.Zr.fire(h,{x:i,y:n})}this.vu()}},t.prototype.pressedMouseMoveEvent=function(t){if(null!==this.nu){var i=this.V(),n=t.localX,s=t.localY;if(null!==this.Qr){this.tu=!1;var h=f(this.iu),r=h.x+(n-this.Qr.x),u=h.y+(s-this.Qr.y);this.au(r,u)}else this.cu()||this.au(n,s);if(!i.timeScale().isEmpty()){var e=this.su.options().handleScroll;if(e.pressedMouseMove&&"touch"!==t.type||(e.horzTouchDrag||e.vertTouchDrag)&&"mouse"!==t.type){var o=this.nu.defaultPriceScale();null!==this.Kr||this.du()||(this.Kr={x:t.clientX,y:t.clientY}),null===this.Kr||this.Kr.x===t.clientX&&this.Kr.y===t.clientY||this.$r||(o.isEmpty()||i.startScrollPrice(this.nu,o,t.localY),i.startScrollTime(t.localX),this.$r=!0),this.$r&&(o.isEmpty()||i.scrollPriceTo(this.nu,o,t.localY),i.scrollTimeTo(t.localX))}}}},t.prototype.mouseUpEvent=function(t){if(null!==this.nu){this.Gr=!1;var i=this.V();if(this.$r){var n=this.nu.defaultPriceScale();i.endScrollPrice(this.nu,n),i.endScrollTime(),this.Kr=null,this.$r=!1}}},t.prototype.longTapEvent=function(t){if(this.Gr=!0,null===this.Qr&&Vn){var i={x:t.localX,y:t.localY};this.wu(i,i)}},t.prototype.mouseLeaveEvent=function(t){null!==this.nu&&(this.nu.model().setHoveredSource(null),yn||this.lu())},t.prototype.clicked=function(){return this.Zr},t.prototype.pinchStartEvent=function(){this.Jr=1},t.prototype.pinchEvent=function(t,i){if(this.su.options().handleScale.pinch){var n=5*(i-this.Jr);this.Jr=i,this.V().zoomTime(t.x,n)}},t.prototype.hitTest=function(t,i){var n=this.nu;if(null===n)return null;for(var s=0,h=n.orderedSources();s<h.length;s++){var r=h[s],u=this.bu(r.paneViews(n),t,i);if(null!==u)return{source:r,view:u.view,object:u.object}}return null},t.prototype.setPriceAxisSize=function(t){f(this._r).setSize(new on(t,this.kr.h))},t.prototype.getSize=function(){return this.kr},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(t));this.kr.equals(t)||(this.kr=t,this.zr.resizeCanvas({width:t.w,height:t.h}),this.Fr.resizeCanvas({width:t.w,height:t.h}),this.ru.style.width=t.w+"px",this.ru.style.height=t.h+"px")},t.prototype.recalculatePriceScale=function(){var t=f(this.nu);t.recalculatePriceScale(t.defaultPriceScale());for(var i=0,n=t.dataSources();i<n.length;i++){var s=n[i];if(t.isOverlay(s)){var h=s.priceScale();null!==h&&t.recalculatePriceScale(h),s.updateAllViews()}}},t.prototype.getImage=function(){return this.zr.canvas},t.prototype.paint=function(t){if(0!==t&&null!==this.nu){if(t>1&&this.recalculatePriceScale(),null!==this._r&&this._r.paint(t),1!==t){var i=cn(this.zr);this.qr(i,this.mu()),this.nu&&(this.Mu(i),this.pu(i),this.gu(i))}var n=cn(this.Fr);n.clearRect(-.5,-.5,this.kr.w,this.kr.h),this.yu(n)}},t.prototype.priceAxisWidget=function(){return this._r},t.prototype.mu=function(){return this.su.options().layout.backgroundColor},t.prototype.hu=function(){null!==this.nu&&this.nu.onDestroyed().unsubscribeAll(this),this.nu=null},t.prototype.qr=function(t,i){ln(t,0,0,this.kr.w,this.kr.h,i)},t.prototype.Mu=function(t){for(var i=f(this.nu),n=this.V().gridSource().paneViews(i),s=i.height(),h=i.width(),r=0,u=n;r<u.length;r++){var e=u[r];t.save();var o=e.renderer(s,h);null!==o&&o.draw(t,!1),t.restore()}},t.prototype.pu=function(t){var i=this.V().watermarkSource();if(null!==i){var n=f(this.nu);if(n.containsSeries())for(var s=i.paneViews(),h=n.height(),r=n.width(),u=0,e=s;u<e.length;u++){var o=e[u];t.save();var a=o.renderer(h,r);null!==a&&a.draw(t,!1),t.restore()}}},t.prototype.yu=function(t){this.ku(this.V().crosshairSource(),t)},t.prototype.gu=function(t){for(var i=f(this.nu).orderedSources(),n=this.V().crosshairSource(),s=0,h=i;s<h.length;s++){var r=h[s];this.Nu(r,t)}for(var u=0,e=i;u<e.length;u++){(r=e[u])!==n&&this.ku(r,t)}},t.prototype.ku=function(t,i){for(var n=f(this.nu),s=t.paneViews(n),h=n.height(),r=n.width(),u=n.model().hoveredSource(),e=null!==u&&u.source===t,o=null!==u&&e&&void 0!==u.object?u.object.hitTestData:void 0,a=0,c=s;a<c.length;a++){var l=c[a].renderer(h,r);null!==l&&(i.save(),l.draw(i,e,o),i.restore())}},t.prototype.Nu=function(t,i){for(var n=f(this.nu),s=t.paneViews(n),h=n.height(),r=n.width(),u=n.model().hoveredSource(),e=null!==u&&u.source===t,o=null!==u&&e&&void 0!==u.object?u.object.hitTestData:void 0,a=0,c=s;a<c.length;a++){var l=c[a].renderer(h,r);null!==l&&void 0!==l.drawBackground&&(i.save(),l.drawBackground(i,e,o),i.restore())}},t.prototype.bu=function(t,i,n){for(var s=0,h=t;s<h.length;s++){var r=h[s],u=r.renderer(this.kr.h,this.kr.w);if(null!==u&&u.hitTest){var e=u.hitTest(i,n);if(null!==e)return{view:r,object:e}}}return null},t.prototype.fu=function(){this.ou(),this.su.adjustSize()},t.prototype.ou=function(){if(null!==this.nu){var t=this.su,i=this.nu.defaultPriceScale().options().position;if(this.Xr!==i){if(null!==this._r&&(this._r.isLeft()?this.uu.removeChild(this._r.getElement()):this.eu.removeChild(this._r.getElement()),this._r.destroy(),this._r=null),"none"!==i){var n=t.model().rendererOptionsProvider();this._r=new Fn(this,t.options().layout,n,i),"left"===i&&this.uu.appendChild(this._r.getElement()),"right"===i&&this.eu.appendChild(this._r.getElement())}this.Xr=i}}},t.prototype.cu=function(){return Vn&&null===this.Qr},t.prototype.du=function(){return Vn&&this.Gr||null!==this.Qr},t.prototype.Su=function(t){return Math.max(0,Math.min(t,this.kr.w-1))},t.prototype.xu=function(t){return Math.max(0,Math.min(t,this.kr.h-1))},t.prototype.au=function(t,i){this.V().setAndSaveCurrentPosition(this.Su(t),this.xu(i),f(this.nu))},t.prototype.lu=function(){this.V().clearCurrentPosition()},t.prototype.vu=function(){this.tu&&(this.Qr=null,this.lu())},t.prototype.wu=function(t,i){this.Qr=t,this.tu=!1,this.au(i.x,i.y);var n=this.V().crosshairSource();this.iu={x:n.appliedX(),y:n.appliedY()}},t.prototype.V=function(){return this.su.model()},t}(),In=function(){function t(t,i,n,s){var h=this;this.o=!0,this.kr=new on(0,0),this.Tr=function(){return h.paint(3)},this.Br="left"===t,this.ah=n.rendererOptionsProvider,this.K=i,this.Cu=s,this.cr=document.createElement("div"),this.cr.style.width="25px",this.cr.style.height="100%",this.cr.style.overflow="hidden",this.zr=wn(this.cr,new on(16,16)),this.zr.subscribeCanvasConfigured(this.Tr)}return t.prototype.destroy=function(){this.zr.unsubscribeCanvasConfigured(this.Tr),this.zr.destroy()},t.prototype.update=function(){this.o=!0},t.prototype.getElement=function(){return this.cr},t.prototype.getSize=function(){return this.kr},t.prototype.setSize=function(t){if(t.w<0||t.h<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(t));this.kr.equals(t)||(this.kr=t,this.zr.resizeCanvas({width:t.w,height:t.h}),this.cr.style.width=t.w+"px",this.cr.style.minWidth=t.w+"px",this.cr.style.height=t.h+"px",this.o=!0)},t.prototype.paint=function(t){if((!(t<3)||this.o)&&0!==this.kr.w&&0!==this.kr.h){this.o=!1;var i=cn(this.zr);this.qr(i),this.Lt(i)}},t.prototype.getImage=function(){return this.zr.canvas},t.prototype.isLeft=function(){return this.Br},t.prototype.Lt=function(t){if(this.Cu()){var i=this.kr.w;t.save(),t.fillStyle=this.K.timeScale.borderColor;var n,s=this.ah.options().borderSize;this.Br?(t.translate(-.5,-.5),n=i-s-1):(t.translate(-.5,-.5),n=0),t.fillRect(n,0,2*s,1),t.restore()}},t.prototype.qr=function(t){ln(t,0,0,this.kr.w,this.kr.h,this.K.layout.backgroundColor)},t}();function Pn(t,i){return t.span>i.span?t:i}!function(t){t[t.BorderSize=1]="BorderSize",t[t.TickLength=3]="TickLength"}(Bn||(Bn={})),function(t){t[t.Default=0]="Default",t[t.EwResize=1]="EwResize"}(zn||(zn={}));var Rn,Wn=function(){function t(t){var i=this;this.Du=null,this.Eu=70,this.Ht=null,this.Tu=!1,this.kr=new on(0,0),this.Xr="none",this.Tr=function(){return i.su.model().lightUpdate()},this.Lr=function(){return i.su.model().lightUpdate()},this.su=t,this.K=t.options().layout,this.Au=document.createElement("tr"),this.Lu=document.createElement("td"),this.Lu.style.padding="0",this.Bu=document.createElement("td"),this.Bu.style.padding="0",this.cr=document.createElement("td"),this.cr.style.height="25px",this.cr.style.padding="0",this.zu=document.createElement("div"),this.zu.style.width="100%",this.zu.style.height="100%",this.zu.style.position="relative",this.zu.style.overflow="hidden",this.cr.appendChild(this.zu),this.zr=wn(this.zu,new on(16,16)),this.zr.subscribeCanvasConfigured(this.Tr);var n=this.zr.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this.Fr=wn(this.zu,new on(16,16)),this.Fr.subscribeCanvasConfigured(this.Lr);var s=this.Fr.canvas;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Au.appendChild(this.Lu),this.Au.appendChild(this.cr),this.Au.appendChild(this.Bu),this.Fu(),this.su.model().mainPriceScaleOptionsChanged().subscribe(this.Fu.bind(this),this),this.dr=new kn(this.Fr.canvas,this,{treatVertTouchDragAsPageScroll:!0,treatHorzTouchDragAsPageScroll:!1})}return t.prototype.destroy=function(){this.dr.destroy(),null!==this.Du&&this.Du.destroy(),this.Fr.unsubscribeCanvasConfigured(this.Lr),this.Fr.destroy(),this.zr.unsubscribeCanvasConfigured(this.Tr),this.zr.destroy()},t.prototype.getElement=function(){return this.Au},t.prototype.stub=function(){return this.Du},t.prototype.mouseDownEvent=function(t){if(!this.Tu){this.Tu=!0;var i=this.su.model();!i.timeScale().isEmpty()&&this.su.options().handleScale.axisPressedMouseMove&&i.startScaleTime(t.localX)}},t.prototype.mouseDownOutsideEvent=function(){var t=this.su.model();!t.timeScale().isEmpty()&&this.Tu&&(this.Tu=!1,this.su.options().handleScale.axisPressedMouseMove&&t.endScaleTime())},t.prototype.pressedMouseMoveEvent=function(t){var i=this.su.model();!i.timeScale().isEmpty()&&this.su.options().handleScale.axisPressedMouseMove&&i.scaleTimeTo(t.localX)},t.prototype.mouseUpEvent=function(t){this.Tu=!1;var i=this.su.model();i.timeScale().isEmpty()&&!this.su.options().handleScale.axisPressedMouseMove||i.endScaleTime()},t.prototype.mouseDoubleClickEvent=function(){this.su.options().handleScale.axisDoubleClickReset&&this.su.model().resetTimeScale()},t.prototype.mouseEnterEvent=function(t){this.su.model().options().handleScale.axisPressedMouseMove&&this.Yr(1)},t.prototype.mouseLeaveEvent=function(t){this.Yr(0)},t.prototype.getSize=function(){return this.kr},t.prototype.setSizes=function(t,i){this.kr&&this.kr.equals(t)||(this.kr=t,this.zr.resizeCanvas({width:t.w,height:t.h}),this.Fr.resizeCanvas({width:t.w,height:t.h}),this.cr.style.width=t.w+"px",this.cr.style.height=t.h+"px"),null!==this.Du&&this.Du.setSize(new on(i,t.h))},t.prototype.width=function(){return this.kr.w},t.prototype.height=function(){return this.kr.h},t.prototype.optimalHeight=function(){var t=this.Vu();return Math.ceil(t.borderSize+t.tickLength+t.fontSize+t.paddingTop+t.paddingBottom)},t.prototype.update=function(){var t=this,i=this.su.model().timeScale().marks();i&&(this.Eu=70,i.forEach((function(i){t.Eu=Math.min(i.span,t.Eu)})))},t.prototype.getImage=function(){return this.zr.canvas},t.prototype.paint=function(t){if(0!==t){if(1!==t){var i=cn(this.zr);this.qr(i),this.Lt(i),this.Ur(i),this.jr(i),null!==this.Du&&this.Du.paint(t)}var n=cn(this.Fr);this.Hr(n)}},t.prototype.qr=function(t){ln(t,0,0,this.kr.w,this.kr.h,this.mu())},t.prototype.Lt=function(t){this.su.options().timeScale.borderVisible&&(t.save(),t.fillStyle=this.Ou(),t.translate(-.5,-.5),t.fillRect(0,0,this.kr.w,1),t.restore())},t.prototype.Ur=function(t){var i=this.su.model().timeScale().marks();if(i&&0!==i.length){var n=i.reduce(Pn,i[0]).span;n>30&&n<40&&(n=30),t.save(),t.strokeStyle=this.Ou();var s=this.Vu(),h=s.borderSize+s.tickLength+s.paddingTop+s.fontSize-s.baselineOffset;if(t.textAlign="center",t.translate(.5,-.5),t.fillStyle=this.Ou(),this.su.model().timeScale().options().borderVisible){t.beginPath();for(var r=i.length;r--;)t.rect(i[r].coord,1,1,s.tickLength);t.fill()}t.fillStyle=this.On(),t.font=this.Iu();for(var u=0,e=i;u<e.length;u++){(a=e[u]).span<n&&t.fillText(a.label,a.coord,h)}t.font=this.Pu();for(var o=0,f=i;o<f.length;o++){var a;(a=f[o]).span>=n&&t.fillText(a.label,a.coord,h)}t.restore()}},t.prototype.jr=function(t){t.save();var i=new Set,n=this.su.model(),s=n.dataSources();i.add(n.crosshairSource());for(var h=this.Vu(),r=0,u=s;r<u.length;r++){var e=u[r];if(!i.has(e))for(var o=0,f=e.timeAxisViews();o<f.length;o++){f[o].renderer().draw(t,h)}}t.restore()},t.prototype.Hr=function(t){t.clearRect(-.5,-.5,this.kr.w,this.kr.h);var i=[],n=this.su.model().crosshairSource().timeAxisViews();i.push(n);var s=this.Vu();i.forEach((function(i){i.forEach((function(i){t.save(),i.renderer().draw(t,s),t.restore()}))}))},t.prototype.mu=function(){return this.K.backgroundColor},t.prototype.Ou=function(){return this.su.options().timeScale.borderColor},t.prototype.On=function(){return this.K.textColor},t.prototype.Zt=function(){return this.K.fontSize},t.prototype.Iu=function(){return Di(this.Zt(),this.K.fontFamily)},t.prototype.Pu=function(){return Di(this.Zt(),this.K.fontFamily,"bold")},t.prototype.Vu=function(){null===this.Ht&&(this.Ht={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new It});var t=this.Ht,i=this.Iu();if(t.font!==i){var n=this.Zt();t.fontSize=n,t.font=i,t.paddingTop=Math.ceil(n/2.5),t.paddingBottom=t.paddingTop,t.paddingHorizontal=Math.ceil(n/2),t.baselineOffset=Math.round(this.Zt()/5),t.widthCache.reset()}return this.Ht},t.prototype.Yr=function(t){this.cr.style.cursor=1===t?"ew-resize":"default"},t.prototype.Fu=function(){var t=this.su.model().mainPriceScale().options().position;if(t!==this.Xr){if(null!==this.Du&&(this.Du.isLeft()?this.Lu.removeChild(this.Du.getElement()):this.Bu.removeChild(this.Du.getElement()),this.Du.destroy(),this.Du=null),"none"!==t){var i={rendererOptionsProvider:this.su.model().rendererOptionsProvider()},n=this.su.model();this.Du=new In(t,this.su.options(),i,(function(){return n.mainPriceScale().options().borderVisible&&n.timeScale().options().borderVisible})),("left"===t?this.Lu:this.Bu).appendChild(this.Du.getElement())}this.Xr=t}},t}(),qn=function(){function t(t,i){var n=this;this.Ru=[],this.Wu=[],this.qu=0,this.Uu=new G,this.nn=0,this._t=0,this.ju=0,this.Hu=null,this.Yu=!1,this.Zr=new G,this.oh=new G,this.K=i,this.Au=document.createElement("div"),this.Au.classList.add("tv-lightweight-charts"),this.Au.style.overflow="hidden",this.Au.style.width="100%",this.Au.style.height="100%",this._u=document.createElement("table"),this._u.setAttribute("cellspacing","0"),this.Au.appendChild(this._u),this.Ku=this.$u.bind(this),this.Au.addEventListener("wheel",this.Ku,{passive:!1}),this.V=new un(this.fh.bind(this),this.K),this.model().crosshairMoved().subscribe(this.Xu.bind(this),this),this.Zu=new Wn(this),this._u.appendChild(this.Zu.getElement());var s=this.K.width,h=this.K.height;if(0===s&&0===h){var r=t.getBoundingClientRect();s=r.width,h=r.height}s=Math.max(70,s),h=Math.max(50,h),this.resize(h,s),this.Ju(),t.appendChild(this.Au),this.Gu(),this.V.timeScale().optionsApplied().subscribe((function(){n.Gu(),n.adjustSize()}),this)}return t.prototype.model=function(){return this.V},t.prototype.options=function(){return this.K},t.prototype.paneWidgets=function(){return this.Ru},t.prototype.destroy=function(){this.Au.removeEventListener("wheel",this.Ku),0!==this.qu&&window.cancelAnimationFrame(this.qu),this.V.crosshairMoved().unsubscribeAll(this),this.V.timeScale().optionsApplied().unsubscribeAll(this),this.V.destroy();for(var t=0,i=this.Ru;t<i.length;t++){var n=i[t];this._u.removeChild(n.getElement()),n.clicked().unsubscribeAll(this),n.destroy()}this.Ru=[];for(var s=0,h=this.Wu;s<h.length;s++){var r=h[s];this.Qu(r)}this.Wu=[],f(this.Zu).destroy(),null!==this.Au.parentElement&&this.Au.parentElement.removeChild(this.Au),this.oh.destroy(),this.Zr.destroy(),delete this.Au},t.prototype.resize=function(t,i,n){if(void 0===n&&(n=!1),this.nn!==t||this._t!==i){this.nn=t,this._t=i;var s=t+"px",h=i+"px";f(this.Au).style.height=s,f(this.Au).style.width=h,this._u.style.height=s,this._u.style.width=h,n?this.te(new zi(3)):this.V.fullUpdate()}},t.prototype.paint=function(t){void 0===t&&(t=new zi(3));for(var i=0;i<this.Ru.length;i++)this.Ru[i].paint(t.invalidateForPane(i).level);this.Zu.paint(t.fullInvalidation())},t.prototype.adjustSize=function(){this.ie(),this.V.fullUpdate()},t.prototype.applyOptions=function(t){this.V.applyOptions(t),this.Gu();var i=t.width||this._t,n=t.height||this.nn;this.resize(n,i)},t.prototype.clicked=function(){return this.Zr},t.prototype.crosshairMoved=function(){return this.oh},t.prototype.takeScreenshot=function(){var t=this;null!==this.Hu&&(this.te(this.Hu),this.Hu=null);var i=this.Ru[0],n=dn(document,new on(this._t,this.nn)),s=an(n),h=0,r=0,u=function(){for(var i=0;i<t.Ru.length;i++){var n=t.Ru[i],u=n.getSize().h,e=f(n.priceAxisWidget()),o=e.getImage();s.drawImage(o,h,r,e.getWidth(),u),r+=u,i<t.Ru.length-1&&(r+=En)}};"left"===this.K.priceScale.position&&(u(),h=f(i.priceAxisWidget()).getWidth()),r=0;for(var e=0;e<this.Ru.length;e++){var o=this.Ru[e],a=o.getSize(),c=o.getImage();if(s.drawImage(c,h,r,a.w,a.h),r+=a.h,e<this.Ru.length-1){var l=this.Wu[e],v=l.getSize(),d=l.getImage();s.drawImage(d,h,r,v.w,v.h),r+=v.h}}h+=i.getSize().w,"right"===this.K.priceScale.position&&(r=0,u());var w=function(){var i=f(t.Zu.stub()),n=i.getSize(),u=i.getImage();s.drawImage(u,h,r,n.w,n.h)};if(this.K.timeScale.visible){h=0,"left"===this.K.priceScale.position&&(w(),h=f(i.priceAxisWidget()).getWidth());var b=this.Zu.getSize();c=this.Zu.getImage();s.drawImage(c,h,r,b.w,b.h),"right"===this.K.priceScale.position&&(h=i.getSize().w,w(),s.restore())}return n},t.prototype.ie=function(){for(var t=0,i=0,n=0,s=this.Ru;n<s.length;n++){var h=s[n];"none"!==this.K.priceScale.position&&(i=Math.max(i,f(h.priceAxisWidget()).optimalWidth())),t+=h.stretchFactor()}for(var r=this._t,u=this.nn,e=Math.max(r-i,0),o=this.Wu.length,a=En*o,c=this.K.timeScale.visible?this.Zu.optimalHeight():0,l=a+c,v=u<l?0:u-l,d=v/t,w=0,b=0;b<this.Ru.length;++b){(h=this.Ru[b]).setState(this.V.panes()[b]);var m,M=0;M=b===this.Ru.length-1?v-w:Math.round(h.stretchFactor()*d),w+=m=Math.max(M,2),h.setSize(new on(e,m)),"none"!==this.K.priceScale.position&&h.setPriceAxisSize(i),h.state()&&this.V.setPaneHeight(h.state(),m)}this.Zu.setSizes(new on(e,c),i),this.V.setWidth(e),this.ju!==i&&(this.ju=i,this.Uu.fire(i))},t.prototype.$u=function(t){var i=t.deltaX/100,n=-t.deltaY/100;if(0!==i&&this.K.handleScroll.mouseWheel||0!==n&&this.K.handleScale.mouseWheel){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:i*=120,n*=120;break;case t.DOM_DELTA_LINE:i*=32,n*=32}if(0!==n&&this.K.handleScale.mouseWheel){var s=Math.sign(n)*Math.min(1,Math.abs(n)),h=t.clientX-this.Au.getBoundingClientRect().left;this.model().zoomTime(h,s)}0!==i&&this.K.handleScroll.mouseWheel&&this.model().scrollChart(-80*i)}},t.prototype.te=function(t){var i=t.fullInvalidation();if(3===i&&this.ne(),3===i||2===i){for(var n=this.V.panes(),s=0;s<n.length;s++)t.invalidateForPane(s).autoScale&&n[s].momentaryAutoScale();t.getFitContent()&&this.V.timeScale().fitContent();var h=t.getTargetTimeRange();null!==h&&this.V.timeScale().setTimePointsRange(h),this.Zu.update()}this.paint(t)},t.prototype.fh=function(t){var i=this;null!==this.Hu?this.Hu.merge(t):this.Hu=t,this.Yu||(this.Yu=!0,this.qu=window.requestAnimationFrame((function(){i.Yu=!1,i.qu=0,null!==i.Hu&&(i.te(i.Hu),i.Hu=null)})))},t.prototype.ne=function(){this.Ju()},t.prototype.Qu=function(t){this._u.removeChild(t.getElement()),t.destroy()},t.prototype.Ju=function(){for(var t=this.V.panes(),i=t.length,n=this.Ru.length,s=i;s<n;s++){var h=o(this.Ru.pop());this._u.removeChild(h.getElement()),h.clicked().unsubscribeAll(this),h.destroy(),void 0!==(r=this.Wu.pop())&&this.Qu(r)}for(s=n;s<i;s++){if((h=new On(this,t[s])).clicked().subscribe(this.se.bind(this),this),this.Ru.push(h),s>1){var r=new Tn(this,s-1,s,!0);this.Wu.push(r),this._u.insertBefore(r.getElement(),this.Zu.getElement())}this._u.insertBefore(h.getElement(),this.Zu.getElement())}for(s=0;s<i;s++){var u=t[s];(h=this.Ru[s]).state()!==u?h.setState(u):h.updatePriceAxisWidget()}this.Gu(),this.ie()},t.prototype.he=function(t,i){var n,s=new Map;null!==t&&this.V.serieses().forEach((function(i){var n=i.dataAt(t);null!==n&&s.set(i,n)}));if(null!==t){var h=this.V.timeScale().indexToUserTime(t);null!==h&&(n=h)}var r=this.model().hoveredSource(),u=null!==r&&r.source instanceof Mi?r.source:void 0,e=null!==r&&void 0!==r.object?r.object.externalId:void 0;return{time:n,point:i||void 0,hoveredSeries:u,seriesPrices:s,hoveredObject:e}},t.prototype.se=function(t,i){var n=this;this.Zr.fire((function(){return n.he(t,i)}))},t.prototype.Xu=function(t,i){var n=this;this.oh.fire((function(){return n.he(t,i)}))},t.prototype.Gu=function(){var t=this.K.timeScale.visible?"":"none";this.Zu.getElement().style.display=t},t}();function Un(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}function jn(t){if(!Ni(t))throw new Error("time must be of type BusinessDay");var i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{timestamp:Math.round(i.getTime()/1e3),businessDay:t}}function Hn(t){if(!Si(t))throw new Error("time must be of type isUTCTimestamp");return{timestamp:t}}function Yn(t){return 0===t.length?null:Ni(t[0].time)?jn:Hn}function _n(t){return Si(t)?Hn(t):Ni(t)?jn(t):jn(ss(t))}function Kn(t,i){var n=t.value,s=null;return"color"in t&&void 0!==t.color&&(s=i.addColor(t.color)),[n,n,n,n,s]}function $n(t,i){return[t.open,t.high,t.low,t.close,null]}!function(t){t[t.LastPriceAndPercentageValue=0]="LastPriceAndPercentageValue",t[t.LastValueAccordingToScale=1]="LastValueAccordingToScale"}(Rn||(Rn={}));var Xn={Candlestick:$n,Bar:$n,Area:Kn,Histogram:Kn,Line:Kn};function Zn(t){return Xn[t]}function Jn(t){return 60*t*60*1e3}function Gn(t){return 60*t*1e3}var Qn,ts=[{divisor:1,span:20},{divisor:(Qn=1,1e3*Qn),span:19},{divisor:Gn(1),span:20},{divisor:Gn(5),span:21},{divisor:Gn(30),span:22},{divisor:Jn(1),span:30},{divisor:Jn(3),span:31},{divisor:Jn(6),span:32},{divisor:Jn(12),span:33}];function is(t,i){if(null!==i){var n=new Date(1e3*i.timestamp),s=new Date(1e3*t.timestamp);if(s.getUTCFullYear()!==n.getUTCFullYear())return 70;if(s.getUTCMonth()!==n.getUTCMonth())return 60;if(s.getUTCDate()!==n.getUTCDate())return 50;for(var h=ts.length-1;h>=0;--h)if(Math.floor(n.getTime()/ts[h].divisor)!==Math.floor(s.getTime()/ts[h].divisor))return ts[h].span}return 20}function ns(t,i){return t.timestamp<i.timestamp}function ss(t){var i=new Date(t);if(isNaN(i.getTime()))throw new Error("Invalid date string="+t+", expected format=yyyy-mm-dd");return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function hs(t){d(t.time)&&(t.time=ss(t.time))}var rs,us=function(){function t(){this.ue=new Map,this.ee=new Map,this.oe=[]}return t.prototype.destroy=function(){this.ue.clear(),this.ee.clear(),this.oe=[]},t.prototype.setSeriesData=function(t,i){var n=this;t.clearData(),function(t){t.forEach(hs)}(i),this.ue.forEach((function(i){return i.mapping.delete(t)}));var s=Yn(i);null!==s&&i.forEach((function(i){var h=s(i.time),r=n.ue.get(h.timestamp)||{index:0,mapping:new Map,timePoint:h};r.mapping.set(t,i),n.ue.set(h.timestamp,r)}));var h=new Map;return this.ue.forEach((function(t,i){t.mapping.size>0&&h.set(i,t)})),this.fe(h)},t.prototype.removeSeries=function(t){return this.setSeriesData(t,[])},t.prototype.updateSeriesData=function(t,i){hs(i);var n=t.data().bars();if(n.size()>0)if(void 0!==f(n.last()).time.businessDay){if(!Ni(i.time))throw new Error("time must be of type BusinessDay")}else if(!Si(i.time))throw new Error("time must be of type isUTCTimestamp");var s=f(Yn([i]))(i.time),h=this.ue.get(s.timestamp)||{index:0,mapping:new Map,timePoint:s},r=0===h.mapping.size;h.mapping.set(t,i);var u=!1;if(r){var e=this.ue.size;this.oe.length>0&&this.oe[this.oe.length-1].timestamp>s.timestamp?(e=Mt(this.oe,s,ns),this.oe.splice(e,0,s),this.ae(e),u=!0):this.oe.push(s),h.index=e,this.ee.set(h.index,s)}this.ue.set(s.timestamp,h);var a=new Map,c=function(i){var n=o(l.ee.get(i));o(l.ue.get(n.timestamp)).mapping.forEach((function(s,h){if(u||h===t){var r=Zn(h.seriesType()),e=a.get(h)||{update:[]},o={index:i,time:n,value:r(s,h.palette())};e.update.push(o),a.set(h,e)}}))},l=this;for(e=h.index;e<this.ue.size;++e)c(e);var v=r?this.ce(h.index):[],d=r?this.oe.slice(h.index):[];return{timeScaleUpdate:{seriesUpdates:a,changes:d,index:h.index,marks:v}}},t.prototype.fe=function(t){var i=this;this.ue=t,this.oe=Array.from(this.ue.values()).map((function(t){return t.timePoint})),this.oe.sort((function(t,i){return t.timestamp-i.timestamp}));var n=new Map;this.oe.forEach((function(t,s){var h=o(i.ue.get(t.timestamp));h.index=s,h.mapping.forEach((function(i,h){var r=Zn(h.seriesType()),u=n.get(h)||{update:[]},e={index:s,time:t,value:r(i,h.palette())};u.update.push(e),n.set(h,u)}))}));var s=null,h=this.oe.map((function(t,i){var n=is(t,s);return s=t,{span:n,time:t,index:i}})),r={seriesUpdates:n,changes:this.oe.slice(),index:0,marks:h};return this.le(),{timeScaleUpdate:r}},t.prototype.ae=function(t){for(var i=this.ee.size-1;i>=t;--i){var n=o(this.ee.get(i)),s=i+1;o(this.ue.get(n.timestamp)).index=s,this.ee.delete(i),this.ee.set(s,n)}},t.prototype.le=function(){var t=this;this.ee.clear(),this.ue.forEach((function(i,n){t.ee.set(i.index,i.timePoint)}))},t.prototype.ce=function(t){for(var i=[],n=this.ee.get(t-1)||null,s=t;s<this.ee.size;++s){var h=o(this.ee.get(s)),r=is(h,n);n=h,i.push({span:r,time:h,index:s})}return i},t}(),es={color:"#FF0000",price:0,lineStyle:1,lineWidth:1},os=function(){function t(t){this.ii=t}return t.prototype.applyOptions=function(t){this.ii.applyOptions(t)},t.prototype.options=function(){return this.ii.options()},t.prototype.priceLine=function(){return this.ii},t}(),fs=function(){function t(t,i){this._series=t,this._dataUpdatesConsumer=i}return t.prototype.destroy=function(){delete this._series,delete this._dataUpdatesConsumer},t.prototype.priceFormatter=function(){return this._series.formatter()},t.prototype.series=function(){return this._series},t.prototype.priceToCoordinate=function(t){var i=this._series.firstValue();return null===i?null:this._series.priceScale().priceToCoordinate(t,i.value)},t.prototype.coordinateToPrice=function(t){var i=this._series.firstValue();return null===i?null:this._series.priceScale().coordinateToPrice(t,i.value)},t.prototype.setData=function(t){this._dataUpdatesConsumer.applyNewData(this._series,t)},t.prototype.update=function(t){this._dataUpdatesConsumer.updateData(this._series,t)},t.prototype.setMarkers=function(t){var i=t.map((function(t){return u(u({},t),{time:_n(t.time)})}));this._series.setMarkers(i)},t.prototype.applyOptions=function(t){this._series.applyOptions(t)},t.prototype.options=function(){return b(this._series.options())},t.prototype.createPriceLine=function(t){var i=c(b(es),t),n=this._series.createPriceLine(i);return new os(n)},t.prototype.removePriceLine=function(t){this._series.removePriceLine(t.priceLine())},t}(),as=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return r(i,t),i.prototype.applyOptions=function(i){Un(i),t.prototype.applyOptions.call(this,i)},i}(fs),cs={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},ls={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},vs={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4},ds={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4},ws={color:"#26a69a",base:0,lineWidth:2},bs={title:"",lastValueVisible:!0,priceLineVisible:!0,priceLineWidth:1,priceLineColor:"",priceLineStyle:1,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},ms=function(){function t(t){this.l=t}return t.prototype.destroy=function(){delete this.l},t.prototype.applyOptions=function(t){this.l.applyOptions({priceScale:t})},t.prototype.options=function(){return this.B().options()},t.prototype.B=function(){return this.l.mainPriceScale()},t}();!function(t){t[t.AnimationDurationMs=1e3]="AnimationDurationMs"}(rs||(rs={}));var Ms=function(){function t(t){this.V=t}return t.prototype.destroy=function(){delete this.V},t.prototype.scrollPosition=function(){return this.Kn().rightOffset()},t.prototype.scrollToPosition=function(t,i){i?this.Kn().scrollToOffsetAnimated(t,1e3):this.Kn().setRightOffset(t)},t.prototype.scrollToRealTime=function(){this.Kn().scrollToRealTime()},t.prototype.getVisibleRange=function(){var t=this.Kn().visibleBars();if(null===t)return null;var i=this.V.timeScale().points(),n=f(i.firstIndex()),s=f(i.lastIndex());return{from:ps(f(i.valueAt(Math.max(n,t.firstBar())))),to:ps(f(i.valueAt(Math.min(s,t.lastBar()))))}},t.prototype.setVisibleRange=function(t){var i={from:_n(t.from),to:_n(t.to)};this.V.setTargetTimeRange(i)},t.prototype.resetTimeScale=function(){this.V.resetTimeScale()},t.prototype.fitContent=function(){this.V.fitContent()},t.prototype.applyOptions=function(t){this.Kn().applyOptions(t)},t.prototype.options=function(){return b(this.Kn().options())},t.prototype.Kn=function(){return this.V.timeScale()},t}();function ps(t){return t.businessDay||t.timestamp}function gs(t){if(void 0!==t&&"custom"!==t.type){var i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;for(var i=0;i<8;i++){var n=Math.round(t);if(Math.abs(n-t)<1e-8)return i;t*=10}return i}(i.minMove))}}var ys=function(){function t(t,i){var n=this;this.ve=new us,this.de=new G,this.we=new Map,this.be=new Map,this.me=new G,this.Me=new G,this.ur=new qn(t,i),this.ur.model().timeScale().visibleBarsChanged().subscribe(this.pe.bind(this)),this.ur.clicked().subscribe((function(t){n.me.hasListeners()&&n.me.fire(n.ge(t()))}),this),this.ur.crosshairMoved().subscribe((function(t){n.Me.hasListeners()&&n.Me.fire(n.ge(t()))}),this);var s=this.ur.model();this.ye=new ms(s),this.ke=new Ms(s)}return t.prototype.remove=function(){this.ur.model().timeScale().visibleBarsChanged().unsubscribeAll(this),this.ur.clicked().unsubscribeAll(this),this.ur.crosshairMoved().unsubscribeAll(this),this.ye.destroy(),this.ke.destroy(),this.ur.destroy(),delete this.ur,this.we.forEach((function(t,i){i.destroy()})),this.we.clear(),this.be.clear(),this.de.destroy(),this.me.destroy(),this.Me.destroy(),this.ve.destroy(),delete this.ve},t.prototype.resize=function(t,i,n){this.ur.resize(t,i,n)},t.prototype.addAreaSeries=function(t){void 0===t&&(t={}),gs(t.priceFormat);var i=c(b(bs),ds,t),n=this.ur.model().createSeries("Area",i),s=new fs(n,this);return this.we.set(s,n),this.be.set(n,s),s},t.prototype.addBarSeries=function(t){void 0===t&&(t={}),gs(t.priceFormat);var i=c(b(bs),ls,t),n=this.ur.model().createSeries("Bar",i),s=new fs(n,this);return this.we.set(s,n),this.be.set(n,s),s},t.prototype.addCandlestickSeries=function(t){void 0===t&&(t={}),Un(t),gs(t.priceFormat);var i=c(b(bs),cs,t),n=this.ur.model().createSeries("Candlestick",i),s=new as(n,this);return this.we.set(s,n),this.be.set(n,s),s},t.prototype.addHistogramSeries=function(t){void 0===t&&(t={}),gs(t.priceFormat);var i=c(b(bs),ws,t),n=this.ur.model().createSeries("Histogram",i),s=new fs(n,this);return this.we.set(s,n),this.be.set(n,s),s},t.prototype.addLineSeries=function(t){void 0===t&&(t={}),gs(t.priceFormat);var i=c(b(bs),vs,t),n=this.ur.model().createSeries("Line",i),s=new fs(n,this);return this.we.set(s,n),this.be.set(n,s),s},t.prototype.removeSeries=function(t){var i=t,n=o(this.we.get(i)),s=this.ve.removeSeries(n),h=this.ur.model();h.removeSeries(n);var r=s.timeScaleUpdate;h.updateTimeScale(r.index,r.changes,r.marks,!0),r.seriesUpdates.forEach((function(t,i){i.updateData(t.update)})),h.updateTimeScaleBaseIndex(0),this.we.delete(i),this.be.delete(n)},t.prototype.applyNewData=function(t,i){var n=this.ve.setSeriesData(t,i),s=this.ur.model(),h=n.timeScaleUpdate;s.updateTimeScale(h.index,h.changes,h.marks,!0),h.seriesUpdates.forEach((function(t,i){i.updateData(t.update)})),s.updateTimeScaleBaseIndex(0)},t.prototype.updateData=function(t,i){var n=this.ve.updateSeriesData(t,i),s=this.ur.model(),h=n.timeScaleUpdate;s.updateTimeScale(h.index,h.changes,h.marks,!1),h.seriesUpdates.forEach((function(t,i){i.updateData(t.update)})),s.updateTimeScaleBaseIndex(0)},t.prototype.subscribeClick=function(t){this.me.subscribe(t)},t.prototype.unsubscribeClick=function(t){this.me.unsubscribe(t)},t.prototype.subscribeCrosshairMove=function(t){this.Me.subscribe(t)},t.prototype.unsubscribeCrosshairMove=function(t){this.Me.unsubscribe(t)},t.prototype.subscribeVisibleTimeRangeChange=function(t){this.de.subscribe(t)},t.prototype.unsubscribeVisibleTimeRangeChange=function(t){this.de.unsubscribe(t)},t.prototype.priceScale=function(){return this.ye},t.prototype.timeScale=function(){return this.ke},t.prototype.applyOptions=function(t){this.ur.applyOptions(t)},t.prototype.options=function(){return this.ur.options()},t.prototype.takeScreenshot=function(){return this.ur.takeScreenshot()},t.prototype.pe=function(){this.de.hasListeners()&&this.de.fire(this.timeScale().getVisibleRange())},t.prototype.Ne=function(t){return o(this.be.get(t))},t.prototype.ge=function(t){var i=this,n=new Map;t.seriesPrices.forEach((function(t,s){n.set(i.Ne(s),t)}));var s=void 0===t.hoveredSeries?void 0:this.Ne(t.hoveredSeries);return{time:t.time&&(t.time.businessDay||t.time.timestamp),point:t.point,hoveredSeries:s,hoveredMarkerId:t.hoveredObject,seriesPrices:n}},t}(),ks={width:0,height:0,layout:{backgroundColor:"#FFFFFF",textColor:"#191919",fontSize:11,fontFamily:Ci},crosshair:{vertLine:{color:"#758696",width:1,style:2,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:2,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},priceScale:{autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,position:"right",borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,scaleMargins:{bottom:.1,top:.2}},timeScale:{rightOffset:0,barSpacing:6,fixLeftEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0},watermark:{color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,text:"",horzAlign:"center",vertAlign:"center"},localization:{locale:navigator.language,dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:!0,axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0}};var Ns=Object.freeze({__proto__:null,version:function(){return"1.2.1"},get LineStyle(){return i},get LineType(){return t},get CrosshairMode(){return U},get PriceScaleMode(){return bi},isBusinessDay:Ni,isUTCTimestamp:Si,createChart:function(t,i){var n=f(d(t)?document.getElementById(t):t),s=void 0===i?b(ks):c(b(ks),i);return new ys(n,s)}});window.LightweightCharts=Ns}();
